<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>The Last Big Thing - Crypto Payment Part3 | Larry007's</title>
<meta name=keywords content="Sector"><meta name=description content="—— It's not happening until we build it."><meta name=author content="Larry007"><link rel=canonical href=https://canonical.url/to/page><meta name=google-site-verification content="G-DTKJNR73EQ"><meta name=yandex-verification content="LarryNumber"><meta name=msvalidate.01 content="LarryNumber"><link crossorigin=anonymous href=/assets/css/stylesheet.fe1a850e072981d20c7002dcff1c903e6e91f92321646a4cbfdf37570edecdcc.css integrity="sha256-/hqFDgcpgdIMcALc/xyQPm6R+SMhZGpMv983Vw7ezcw=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/favicon16.png><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/favicon32.png><link rel=apple-touch-icon href=http://localhost:1313/appletouch.png><link rel=mask-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://localhost:1313/writings/the-last-big-thing-part3/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-DTKJNR73EQ"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-DTKJNR73EQ")</script><meta property="og:image" content="http://localhost:1313/writings/the-last-big-thing-part3/cover.jpg"><meta property="og:image:width" content="120"><meta property="og:image:height" content="120"><meta property="og:title" content="The Last Big Thing - Crypto Payment Part3"><meta property="og:description" content="—— It's not happening until we build it."><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/writings/the-last-big-thing-part3/"><meta property="article:section" content="writings"><meta property="article:published_time" content="2024-11-05T10:30:00+08:00"><meta property="article:modified_time" content="2024-11-05T10:30:00+08:00"><meta property="og:site_name" content="Larry007's"><meta name=twitter:card content="summary"><meta name=twitter:image content="http://localhost:1313/writings/the-last-big-thing-part3/cover.jpg"><meta name=twitter:title content="The Last Big Thing - Crypto Payment Part3"><meta name=twitter:description content="—— It's not happening until we build it."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Writings","item":"http://localhost:1313/writings/"},{"@type":"ListItem","position":2,"name":"The Last Big Thing - Crypto Payment Part3","item":"http://localhost:1313/writings/the-last-big-thing-part3/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"The Last Big Thing - Crypto Payment Part3","name":"The Last Big Thing - Crypto Payment Part3","description":"—— It's not happening until we build it.","keywords":["Sector"],"articleBody":"The previous articles explored traditional payment systems and blockchain’s unique advantages, along with current challenges in crypto payments. This final installment analyzes emerging trends and innovations that could overcome these obstacles. From non-custodial solutions to DeFi integration, these developments could fundamentally reshape value transfer in the crypto age.\n4. Trends 4.1 The Rise of Non-custodial Solutions In the past two years, numerous innovative account designs have emerged, gradually dismantling previous barriers. Soon, users will no longer need to convert their crypto into fiat currency in advance.\nResource Lock - Instruments to prevent double spending\nImplementations: MPC, TEE, Smart Contract, etc.\nIssues solved: Double Spending, Latency\nA resource lock is an instrument designed to help users make credible commitments regarding their account activities. It allows users to ensure that their account will or will not engage in specific behaviors, potentially based on certain conditions. One of the most common applications is preventing double spending, where users can credibly ensure they won’t spend the same assets in their account more than once. This assurance allows service providers to proceed with the next steps even before the transaction is fully settled or finalized.\nResource Lock Can Improve UX By Large\nI borrowed the term from Frontier’s research article, but these implementations have been widely used in the industry long before One Balance was introduced.\nCase1 - StablesMoney\nFor example, Stables Money, an Australian-based card issuer, keeps users’ funds on-chain until payments are made. Stables utilizes MPC wallets, where private keys are split into three shards managed separately by the users, Stables, and Fireblocks, one of the largest custody providers. When a payment is initiated, Stables facilitates co-signing, initiates the transaction, and confirms it with the card network instantly. Meanwhile, they update the user’s balance in their own database even before the transaction is finalized on-chain. When the user initiates a subsequent transaction, Stables checks the user’s balance against their internal records, rejecting any double spending attempts. Under this setup, the only way for users to double spend is by bypassing Stables and colluding with Fireblocks within a short window, which is highly unlikely. However, this approach is still centralized, and theoretically, Stables and Fireblocks could collude to steal users’ funds.\nCase2 - Gnosis Pay\nGnosis Pay takes a different approach, prioritizing decentralization over efficiency. In Gnosis Pay’s system, transactions are categorized into card transactions and non-card transactions, with the latter typically initiated directly through wallets by users. Card transactions are confirmed instantly, while non-card ones are subject to a delay - a three-minute waiting period, during which time any previously initiated card transaction is usually settled and notified to the providers already. This design choice also helps mitigate the risk of a malicious double spending effectively.\nGnosis Pay implemented this method by adding a “delay module” developed by Zodiac on top of a standard SAFE account. This solution is subtle and elegant but also very specific, which results in limited efficiency and flexibility. For example, if a user needs to quickly reallocate funds to prevent a liquidation, a three-minute waiting period could be fatal. It’s also worth mentioning that this type of transaction processing doesn’t support all card transactions, such as complex reversals or delayed refunds.\nA resource lock can also be programmed to operate under specific conditions. For instance, in the cross-chain NFT purchasing scenario mentioned by Frontier, the locked funds could either be claimed by any solver who presents a valid fulfillment proof or be returned to the user after a set expiration period. Nowadays the cross-chain transaction experience has improved significantly between L2s and fast chains, but with a resource lock, waiting times can be minimized, even when bridging from the mainnet.\nresource_lock: { lock: 1500 USDC, fulfill: DeGods #12345, expiry: Solana block 245547084 } Source: Frontier Tech\nThis example demonstrates that a resource lock has versatile applications and should not limited to payments or cross-chain transactions alone.\nAnother implementation method that is certainly worth exploring involves leveraging TEEs. Within TEE, a resource lock would be fully programmable and highly efficient. By incorporating a decentralized network and robust attestation mechanisms, many of the concerns related to centralization and collusion could be alleviated. If implemented correctly, this approach could also achieve a high degree of security.\nResource locks may introduce additional trust assumptions, but when properly implemented, they have the potential to unlock a myriad of use cases that are currently infeasible and significantly enhance the user experience. The greatest advantage of this concept lies in its ability to allow the next action to proceed as if the previous one has already been completed, thereby eliminating many of the frictions that typically hinder user experience. Essentially, “it decouples fulfillment from settlement”, said Frontier.\nA card issuer could confirm a transaction as though it has already been settled. A solver could advance funds to the user on the destination chain as if the assets were already locked on the source chain.\nImagine a future where not only users but also solvers, market makers, and other providers adopt resource locks with a uniform, interoperable standard. In such a scenario, the entire process - from initiating a transaction to routing, fulfilling, and confirming it - could occur in an instant. This would finally bring instant, low-cost, and enriched crypto usage experience on par with that of Web2.\nFast confirmation - Near-Instant Transaction Confirmations\nImplementations: High-performance chains, Pre-confirmation, etc.\nIssues solved: Double spending, Latency\nAnother approach to addressing finality and latency is to enable fast confirmations. One viable method is to develop high-performance, stable chains where even large volumes of transactions can be settled in real-time. When a transaction is settled within milliseconds, providers and merchants receive a definitive outcome instantly, making it extremely difficult for even sophisticated attackers to double spend or exploit the system. Teams like MegaETH and others are actively working on this front.\nAlternatively, on mainnet or based rollups, pre-confirmations could achieve similar results if implemented effectively. Pre-confirmation allows L1 proposers to opt into a new supply branch, allocating part of the block space and committing to include certain transactions in advance, before the entire block is constructed and broadcast across the network. Projects like Commit Boost, Luban, and Chainbound are among those undertaking the comprehensive design and engineering required to make this a reality.\nSmart Contract Accounts - Customized logic and enriched function defined by smart contracts\nImplementations: Zerodev, Particle, etc.\nIssues solved: Signing \u0026 Managing\nThe signing experience is generally straightforward when using crypto-native apps for payments, as a wallet is embedded, and transactions are signed when users select “pay now” or “transfer.” However, this becomes a challenge for non-custodial card designers, who must ask users to swipe their cards and approve transactions separately. Tangem is developing a product that combines a hardware wallet and a payment card, but this approach requires customized manufacturing, which increases costs.\nFurthermore, the signature curve used by most mainstream blockchains today, Secp256k1, is not integrated or supported by most mobile manufacturers. As a result, private keys for EOAs are typically managed at the software level rather than leveraging the secure enclaves used in modern mobile key management, which introduces additional risks for payment app users.\nThere is also a growing demand for fine-grained payment access controls. For example, enterprises may want to grant access to employees only during business trips, with specific spending limits. Parents might want to allow their children to use a card for specific purposes under certain limits.\nTo address these needs, smart contract accounts are being actively developed by various startups. These accounts enable users to delegate balance deductions to others on their behalf, with the ability to specify spending limits, time constraints, and other granular details.\nPay Master - Enabling gas payment for others or in alternative tokens\nImplementations: Biconomy Paymaster, Pimlico Paymaster, etc.\nIssues solved: Gas Fees\nAbstracting gas fees away from the user experience is crucial for making blockchain technology more accessible and user-friendly.\nSummarizing above into one chart:\nHurdles For Non-custodial Crypto Payment And Primitives That Help\n4.2 Integration with Defi Protocols Users are increasingly seeking payment products that seamlessly integrate with Defi protocols, offering yield opportunities and sophisticated asset management in a trustless manner.\nThe traditional payment system, despite its complexity, essentially only revolves around two basic instructions: debit and credit. As Holyheld describes in their whitepaper:\n“…In-between consumer and product there are numerous intermediaries each one of them executing, transmitting, or relaying a simple instruction. At each step, there is a reconciliation of debit and credit instructions. It is not possible to program or enrich such instructions…”\nTo access additional asset management tools and opportunities, users are forced to turn to separate institutions and third parties. This reliance on siloed, independently maintained ledgers introduces significant costs and frictions.\nDefi was created to address these issues. While still in its early stages, Defi has already introduced a variety of on-chain yield opportunities, including:\nStaking and restaking - Earning yield by helping to operate a blockchain or protocol. LP fees - Generating revenue by providing liquidity where depth or immediacy matters RWA - yield from redirecting on-chain funds to off-chain assets CeDefi - revenue from redirecting on-chain funds to off-chain strategies Moreover, we’re witnessing the development of numerous automation tools, combinations, derivatives, and strategies built on top of these protocols. The logical next step is to close the last mile by integrating payment applications with Defi protocols. This would allow users to store, manage, and spend their assets seamlessly and trustlessly within one single account.\nCase1 - Etherfi\nPartnering with Scroll, Etherfi recently launched a “real” credit card, which aligns perfectly with this mission. Currently, Etherfi is best known as an LRT protocol built on top of EigenLayer. However, with the introduction of Cash, users will gain the ability to borrow and spend stablecoins against their staking positions using Visa credit cards issued through the platform. The outstanding balances on these cards can be automatically paid off with the interest generated from their staking. Etherfi also offers Liquid, which provides vaults with automated Defi strategies. Users simply deposit their tokens, and behind the scenes, the vault allocates funds across various Defi positions.\nCase2 - RoboSaver In contrast, Onchainification Labs advocates for a non-custodial approach. They have released an alpha version of RoboSaver, a smart contract module designed for installation on the Safe smart account that underpins every Gnosis Pay card. This module allows users to deposit the idle balance into Defi protocols like Balancer or Aura, where it earns yield and collects swapping fees. When the card balance falls below a certain threshold, RoboSaver automatically withdraws assets from the pool to top up the card. The contracts have already been deployed, and a withdrawal was successfully triggered during an experiment where they purchased a coffee.\nHere are two products or features that I think hold the most immense potential:\nAllowing users to borrow and pay with stablecoins against their staking/restaking positions (just as Etherfi Cash is doing):\nStaking is a cornerstone in the crypto world, often viewed as the equivalent of a risk-free rate. It offers simplicity and predictable yields, attracting a significant number of participants and substantial assets. Many stakers, especially large investors (whales), might appreciate having a card for everyday use.\nIt might sound like a credit card, but can be uniquely structured by incorporating a liquidity pool model between users and issuers. This way, issuers wouldn’t need to use their own funds for transactions, allowing assets to be settled promptly.\nAlternatively, we could leverage existing lending protocols like AAVE or Compound. The Holyheld team has conducted internal tests for credit lines using wstETH (Lido) and AAVE’s V3 delegation module. While the system functions as intended, there’s a significant limitation: AAVE’s credit delegation only supports an “all or nothing” approach. This means it’s impossible to delegate just a portion of the position or a specific amount. Compound faces the same issue.\nAllowing users to hold and pay with (risk-free) yield-bearing assets:\nIt’s ironic that most crypto users - from retail investors to most professional institutions - continue to lend funds to Tether and Circle without receiving any yield in return. In a highly digitalized world, users should be experiencing more transparency and fairness, not continued exploitation by centralized entities. RWAs, particularly yield-bearing stablecoins, are poised to iterate on the current ones. The importance of a risk-free, yield-bearing stablecoin cannot be overstated, as bonds and treasuries have long been the go-to investment vehicles in many parts of the world. These are highly standardized, easy to understand, and backed by sovereign nations. Many people hold USDT or USDC as a digital alternative to the dollar, primarily because it offers better protection against inflation than the fiat currency of their own country. Naturally, these users would also want to earn a risk-free interest rate on their holdings. However, adoption remains low, and this can be attributed to two main factors:\nOn-chain challenges: The current standards for yield-bearing tokens are not easily integrated into existing systems, creating friction.\nFor a token to be considered a stablecoin, its value must remain stable, but the assets backing these RWA protocols, like treasuries and bonds, appreciate over time. To pass this value back to users while keeping the token price stable, many yield-bearing stablecoins, such as USDM by Mountain and STBT by Matrixport, use a rebase token model. This model adjusts all holders’ balances proportionally using a rebaseFactor to reflect the accrued value. Although it’s a neat design, it has yet to gain widespread support from Defi protocols, wallets, and centralized exchanges, where the simpler ERC-20 standard still dominates. Additionally, these protocols typically trigger the rebase process once a day, which can create arbitrage opportunities for traders and lead to price fluctuations that many users find undesirable. One possible solution is to stream rewards on a block-by-block basis, which could help smooth out price fluctuations. However, this approach would incur significant gas costs, and the potential for arbitrage would still remain.\nOff-chain Challenges: Issuing these types of assets could potentially expose projects to significant legal risks, particularly from the SEC, as they may be deemed “unregistered securities.”\nThis is why many of these projects explicitly exclude U.S. residents or citizens from their services. These protocols often invest considerable time and resources in developing legal frameworks to ensure that users can retrieve their assets even if the protocol itself fails (bankruptcy remote). However, until new legislation is passed or any precedent-setting case is decided, the legal outlook for these projects remains uncertain.\nAnother key factor in establishing a widely adopted stablecoin is building a comprehensive, globally distributed banking support network. While on-ramping is important, ensuring a smooth off-ramp process for merchants or institutions is even more critical. Tether achieves this through a network of distributors, while Circle leverages its compliance and strong relationships with various banks. New entrants into the market will need to determine their own strategies. For RWAs, gaining access to deep liquidity, such as that offered by firms like BlackRock, could be crucial.\nIn the near future, payment systems will become seamlessly integrated into the entire Defi ecosystem. Individuals will have access to a wide range of investment vehicles, management tools, and strategies, all from a unified account.\nMoreover, cryptocurrency payments will be increasingly integrated into traditional financial systems. Currently, issuing banks are the first to adopt cryptocurrency because they manage the initial stages of fund flow and are most downstream in the information flow. Once these issuers handle the conversion between crypto and fiat, other participants, such as card networks and acquiring banks, can operate without needing to be aware of the cryptocurrency involved.\nHowever, in the long term, we can expect cryptocurrency to be integrated further downstream in the fund flow - or, conversely, further upstream in the information flow - due to its efficiency and cost-effectiveness, with fewer conversions required. We’ve already seen Visa and MasterCard actively exploring the integration of crypto into their networks and traditional payment rails, signaling a definitive shift in the industry. Similarly, Stripe’s recent move to enable stablecoin payments further underscores this trend.\nAs cryptocurrency adoption grows, more funds will remain on-chain for secure and convenient management, as well as to take advantage of better yield opportunities, with conversions to fiat occurring only when necessary.\n5. Closing Thoughts 5.1 How should crypto payments ideally work? While the exact future remains uncertain, we can envision an ideal scenario based on current knowledge and trends.\nIn the future, the process of making crypto payments should be as seamless and quick as today’s digital payments. Customers would only need to engage in a brief interaction with the merchant, similar to how we currently use QR codes, NFC, or biometric authentication. This simple interaction would allow the merchant to identify the user’s abstracted or smart account, powered by the primitives discussed in section 3.2.1.\nA payment processor, serving as one of the few intermediaries in this streamlined system, would handle a range of security checks on behalf of the merchant and the user. These checks might include identity verification, balance confirmation, AML compliance, fraud detection, and access control, among others. Once these checks are successfully completed, the payment request would be routed to the user’s smart account.\nThis smart account could be used to hold a variety of assets, such as those related to staking, liquidity provision, RWA, CeDefi products, or other yield-generating opportunities and their combinations. Importantly, these assets would remain non-custodial, fully controlled by the user. Pre-authorization and access control would be defined and granted through smart contracts, with gas fees often being covered by the app or service provider.\nTo ensure speed and security, the system could leverage resource locks, fast confirmations, or high-performance chains. This would enable payment processors or other service providers to confirm transactions almost instantly, minimizing the risk of malicious activity. The merchant would receive immediate notification of the transaction’s completion status, while the actual settlement of funds could occur either instantly or at a later time. Ultimately, the corresponding assets would be transferred to the merchant’s account, closing the transaction.\n(Ideal) Crypto Payment Flowchart\nAs you may have noticed, in addition to the payment processor, another third party that users and merchants will likely need to rely on is the account service provider or manager. This necessity arises because basic native accounts, such as EVM EOAs, are insufficient for delivering the smooth experience and complex management. Moreover, a purely open-source solution may struggle to keep pace with the rapid evolution of blockchain technology and the changing needs of users. A key advantage of crypto payments, which helps minimize the number of intermediaries and thus reduces costs, is that blockchain unifies the flow of funds and information within a single ledger.\n5.2 Unification, Democratization, and Disintermediation Payment Eras\nTo summarize the entire article:\nCard payments marked the beginning of the digitalization of financial transactions, leveraging computers and the internet for bookkeeping and information transmission. As the payment industry grew and technology advanced, the process involved an increasing number of specialized intermediaries. Digital payments furthered this digitalization by utilizing emerging technologies as consumer internet usage became widespread. It also disintermediated the traditional process by abstracting away customers’ direct interactions with banks.\nBlockchain and crypto payments take this disintermediation a step further, offering a system where users retain control of their assets while gaining access to a wide array of composable yield opportunities and asset management tools. This technology provides a decentralized and permissionless network, making digital assets and ownership accessible to nearly everyone on the planet. It fosters a transparent and neutral environment where all parties can collaborate without needing to establish trust beforehand.\nDisclaimer: The views, information, and opinions expressed in this article are solely my own and do not reflect the official position of my employer or its affiliates. This post is for informational purposes only and should not be construed as investment, financial, legal, or tax advice. Nothing contained herein constitutes an offer to sell, a solicitation of an offer to buy, or a recommendation for any digital asset or investment. The information presented is subject to change without notice and makes no representation about the accuracy, completeness, or timeliness of the content.\n","wordCount":"3358","inLanguage":"en","image":"http://localhost:1313/writings/the-last-big-thing-part3/cover.jpg","datePublished":"2024-11-05T10:30:00+08:00","dateModified":"2024-11-05T10:30:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/writings/the-last-big-thing-part3/"},"publisher":{"@type":"Organization","name":"Larry007's","logo":{"@type":"ImageObject","url":"http://localhost:1313/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="Larry007 (Alt + H)"><img src=http://localhost:1313/appletouch.png alt aria-label=logo height=35>Larry007</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/writings/ title=Writings><span>Writings</span></a></li><li><a href=http://localhost:1313/backings/ title=Backings><span>Backings</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/>Home</a>&nbsp;»&nbsp;<a href=http://localhost:1313/writings/>Writings</a></div><h1 class="post-title entry-hint-parent">The Last Big Thing - Crypto Payment Part3</h1><div class=post-description><strong><em>—— It's not happening until we build it.</em></strong></div><div class=post-meta><span title='2024-11-05 10:30:00 +0800 CST'>November 5, 2024</span>&nbsp;·&nbsp;<a href=https://x.com/Larry_007__ target=_blank rel="noopener noreferrer">Larry007</a></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#4-trends aria-label="4. Trends">4. Trends</a><ul><li><a href=#41-the-rise-of-non-custodial-solutions aria-label="4.1 The Rise of Non-custodial Solutions">4.1 The Rise of Non-custodial Solutions</a></li><li><a href=#42-integration-with-defi-protocols aria-label="4.2 Integration with Defi Protocols">4.2 Integration with Defi Protocols</a></li></ul></li><li><a href=#5-closing-thoughts aria-label="5. Closing Thoughts">5. Closing Thoughts</a><ul><li><a href=#51-how-should-crypto-payments-ideally-work aria-label="5.1 How should crypto payments ideally work?">5.1 How should crypto payments ideally work?</a></li><li><a href=#52-unification-democratization-and-disintermediation aria-label="5.2 Unification, Democratization, and Disintermediation">5.2 Unification, Democratization, and Disintermediation</a></li></ul></li></ul></div></details></div><div class=post-content><p><em>The <a href=https://larryliu007.github.io/writings/the-last-big-thing-part2/ style=color:#0e97cb>previous</a> articles explored traditional payment systems and blockchain&rsquo;s unique advantages, along with current challenges in crypto payments. This final installment analyzes emerging trends and innovations that could overcome these obstacles. From non-custodial solutions to DeFi integration, these developments could fundamentally reshape value transfer in the crypto age.</em></p><h1 id=4-trends>4. Trends<a hidden class=anchor aria-hidden=true href=#4-trends>#</a></h1><h2 id=41-the-rise-of-non-custodial-solutions>4.1 The Rise of Non-custodial Solutions<a hidden class=anchor aria-hidden=true href=#41-the-rise-of-non-custodial-solutions>#</a></h2><p>In the past two years, numerous innovative <em><strong>account designs</strong></em> have emerged, gradually dismantling previous barriers. Soon, users will no longer need to convert their crypto into fiat currency in advance.</p><p><span style=color:#12b886><em>Resource Lock - Instruments to prevent double spending</em></span><br><span style=color:#0e97cb><em>Implementations: MPC, TEE, Smart Contract, etc.</em></span><br><span style=color:#d73504><em>Issues solved: Double Spending, Latency</em></span></p><p>A resource lock is an instrument designed to help users make credible commitments regarding their account activities. It allows users to ensure that their account will or will not engage in specific behaviors, potentially based on certain conditions. One of the most common applications is preventing double spending, where users can credibly ensure they won&rsquo;t spend the same assets in their account more than once. This assurance allows service providers to proceed with the next steps even before the transaction is fully settled or finalized.</p><p><span style=color:#0e97cb><em>Resource Lock Can Improve UX By Large</em></span></p><div align=center><img src=/The_Last_Big_Thing/pic12.png></div><p>I borrowed the term from Frontier&rsquo;s research article, but these implementations have been widely used in the industry long before One Balance was introduced.</p><p><em><strong>Case1 - StablesMoney</strong></em></p><p>For example, Stables Money, an Australian-based card issuer, keeps users&rsquo; funds on-chain until payments are made. Stables utilizes MPC wallets, where private keys are split into three shards managed separately by the users, Stables, and Fireblocks, one of the largest custody providers. When a payment is initiated, Stables facilitates co-signing, initiates the transaction, and confirms it with the card network instantly. Meanwhile, they update the user&rsquo;s balance in their own database even before the transaction is finalized on-chain. When the user initiates a subsequent transaction, Stables checks the user&rsquo;s balance against their internal records, rejecting any double spending attempts. Under this setup, the only way for users to double spend is by bypassing Stables and colluding with Fireblocks within a short window, which is highly unlikely. However, this approach is still centralized, and theoretically, Stables and Fireblocks could collude to steal users&rsquo; funds.</p><p><em><strong>Case2 - Gnosis Pay</strong></em></p><p>Gnosis Pay takes a different approach, prioritizing decentralization over efficiency. In Gnosis Pay&rsquo;s system, transactions are categorized into card transactions and non-card transactions, with the latter typically initiated directly through wallets by users. Card transactions are confirmed instantly, while non-card ones are subject to a delay - a three-minute waiting period, during which time any previously initiated card transaction is usually settled and notified to the providers already. This design choice also helps mitigate the risk of a malicious double spending effectively.</p><p>Gnosis Pay implemented this method by adding a &ldquo;<a href="https://github.com/gnosisguild/zodiac-modifier-delay?tab=readme-ov-file">delay module</a>&rdquo; developed by Zodiac on top of a standard SAFE account. This solution is subtle and elegant but also very specific, which results in limited efficiency and flexibility. For example, if a user needs to quickly reallocate funds to prevent a liquidation, a three-minute waiting period could be fatal. It’s also worth mentioning that this type of transaction processing doesn’t support all card transactions, such as complex reversals or delayed refunds.</p><p>A resource lock can also be programmed to operate under specific conditions. For instance, in the cross-chain NFT purchasing scenario mentioned by Frontier, the locked funds could either be claimed by any solver who presents a valid fulfillment proof or be returned to the user after a set expiration period. Nowadays the cross-chain transaction experience has improved significantly between L2s and fast chains, but with a resource lock, waiting times can be minimized, even when bridging from the mainnet.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=n>resource_lock</span>: <span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>lock</span>: <span class=mi>1500</span><span class=w> </span><span class=no>USDC</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>fulfill</span>: <span class=nc>DeGods</span><span class=w> </span>#<span class=mi>12345</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>expiry</span>: <span class=nc>Solana</span><span class=w> </span><span class=n>block</span><span class=w> </span><span class=mi>245547084</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p><em>Source: <a href=https://ethresear.ch/t/introducing-onebalance/19557>Frontier Tech</a></em></p><p>This example demonstrates that a resource lock has versatile applications and should not limited to payments or cross-chain transactions alone.</p><p>Another implementation method that is certainly worth exploring involves leveraging TEEs. Within TEE, a resource lock would be fully programmable and highly efficient. By incorporating a decentralized network and robust attestation mechanisms, many of the concerns related to centralization and collusion could be alleviated. If implemented correctly, this approach could also achieve a high degree of security.</p><p>Resource locks may introduce additional trust assumptions, but when properly implemented, they have the potential to unlock a myriad of use cases that are currently infeasible and significantly enhance the user experience. The greatest advantage of this concept lies in its ability to allow the next action to proceed as if the previous one has already been completed, thereby eliminating many of the frictions that typically hinder user experience. Essentially, &ldquo;it decouples fulfillment from settlement&rdquo;, said Frontier.</p><p>A card issuer could confirm a transaction as though it has already been settled. A solver could advance funds to the user on the destination chain as if the assets were already locked on the source chain.</p><p>Imagine a future where not only users but also solvers, market makers, and other providers adopt resource locks with a uniform, interoperable standard. In such a scenario, the entire process - from initiating a transaction to routing, fulfilling, and confirming it - could occur in an instant. This would finally bring instant, low-cost, and enriched crypto usage experience on par with that of Web2.</p><p><span style=color:#12b886><em>Fast confirmation - Near-Instant Transaction Confirmations</em></span><br><span style=color:#0e97cb><em>Implementations: High-performance chains, Pre-confirmation, etc.</em></span><br><span style=color:#d73504><em>Issues solved: Double spending, Latency</em></span></p><p>Another approach to addressing finality and latency is to enable fast confirmations. One viable method is to develop high-performance, stable chains where even large volumes of transactions can be settled in real-time. When a transaction is settled within milliseconds, providers and merchants receive a definitive outcome instantly, making it extremely difficult for even sophisticated attackers to double spend or exploit the system. Teams like MegaETH and others are actively working on this front.</p><p>Alternatively, on mainnet or based rollups, pre-confirmations could achieve similar results if implemented effectively. Pre-confirmation allows L1 proposers to opt into a new supply branch, allocating part of the block space and committing to include certain transactions in advance, before the entire block is constructed and broadcast across the network. Projects like Commit Boost, Luban, and Chainbound are among those undertaking the comprehensive design and engineering required to make this a reality.</p><p><span style=color:#12b886><em>Smart Contract Accounts - Customized logic and enriched function defined by smart contracts</em></span><br><span style=color:#0e97cb><em>Implementations: Zerodev, Particle, etc.</em></span><br><span style=color:#d73504><em>Issues solved: Signing & Managing</em></span></p><p>The signing experience is generally straightforward when using crypto-native apps for payments, as a wallet is embedded, and transactions are signed when users select &ldquo;pay now&rdquo; or &ldquo;transfer.&rdquo; However, this becomes a challenge for non-custodial card designers, who must ask users to swipe their cards and approve transactions separately. Tangem is developing a product that combines a hardware wallet and a payment card, but this approach requires customized manufacturing, which increases costs.</p><p>Furthermore, the signature curve used by most mainstream blockchains today, Secp256k1, is not integrated or supported by most mobile manufacturers. As a result, private keys for EOAs are typically managed at the software level rather than leveraging the secure enclaves used in modern mobile key management, which introduces additional risks for payment app users.</p><p>There is also a growing demand for fine-grained payment access controls. For example, enterprises may want to grant access to employees only during business trips, with specific spending limits. Parents might want to allow their children to use a card for specific purposes under certain limits.</p><p>To address these needs, smart contract accounts are being actively developed by various startups. These accounts enable users to delegate balance deductions to others on their behalf, with the ability to specify spending limits, time constraints, and other granular details.</p><p><span style=color:#12b886><em>Pay Master - Enabling gas payment for others or in alternative tokens</em></span><br><span style=color:#0e97cb><em>Implementations: Biconomy Paymaster, Pimlico Paymaster, etc.</em></span><br><span style=color:#d73504><em>Issues solved: Gas Fees</em></span></p><p>Abstracting gas fees away from the user experience is crucial for making blockchain technology more accessible and user-friendly.</p><p>Summarizing above into one chart:<br><span style=color:#0e97cb><em>Hurdles For Non-custodial Crypto Payment And Primitives That Help</em></span></p><div align=center><img src=/The_Last_Big_Thing/pic13.jpeg></div><h2 id=42-integration-with-defi-protocols><strong>4.2 Integration with Defi Protocols</strong><a hidden class=anchor aria-hidden=true href=#42-integration-with-defi-protocols>#</a></h2><p>Users are increasingly seeking payment products that seamlessly integrate with Defi protocols, offering yield opportunities and sophisticated asset management in a trustless manner.</p><p>The traditional payment system, despite its complexity, essentially only revolves around two basic instructions: debit and credit. As Holyheld describes in their whitepaper:</p><p>&ldquo;…In-between consumer and product there are numerous intermediaries each one of them executing, transmitting, or relaying a simple instruction. At each step, there is a reconciliation of debit and credit instructions. It is not possible to program or enrich such instructions…&rdquo;</p><p>To access additional asset management tools and opportunities, users are forced to turn to separate institutions and third parties. This reliance on siloed, independently maintained ledgers introduces significant costs and frictions.</p><p>Defi was created to address these issues. While still in its early stages, Defi has already introduced a variety of on-chain yield opportunities, including:</p><ul><li>Staking and restaking - Earning yield by helping to operate a blockchain or protocol.</li><li>LP fees - Generating revenue by providing liquidity where depth or immediacy matters</li><li>RWA - yield from redirecting on-chain funds to off-chain assets</li><li>CeDefi - revenue from redirecting on-chain funds to off-chain strategies</li></ul><p>Moreover, we&rsquo;re witnessing the development of numerous automation tools, combinations, derivatives, and strategies built on top of these protocols. The logical next step is to close the last mile by integrating payment applications with Defi protocols. This would allow users to store, manage, and spend their assets seamlessly and trustlessly within one single account.</p><p><em><strong>Case1 - Etherfi</strong></em></p><p>Partnering with Scroll, Etherfi recently launched <a href=https://x.com/ether_fi/status/1833132921143906398>a &ldquo;real&rdquo; credit card</a>, which aligns perfectly with this mission. Currently, Etherfi is best known as an LRT protocol built on top of EigenLayer. However, with the introduction of Cash, users will gain the ability to borrow and spend stablecoins against their staking positions using Visa credit cards issued through the platform. The outstanding balances on these cards can be automatically paid off with the interest generated from their staking. Etherfi also offers Liquid, which provides vaults with automated Defi strategies. Users simply deposit their tokens, and behind the scenes, the vault allocates funds across various Defi positions.</p><p><em><strong>Case2 - RoboSaver</strong></em>
In contrast, Onchainification Labs advocates for a non-custodial approach. They have released an alpha version of <a href=https://github.com/onchainification/robosaver>RoboSaver</a>, a smart contract module designed for installation on the Safe smart account that underpins every Gnosis Pay card. This module allows users to deposit the idle balance into Defi protocols like Balancer or Aura, where it earns yield and collects swapping fees. When the card balance falls below a certain threshold, RoboSaver automatically withdraws assets from the pool to top up the card. The contracts have already been deployed, and a withdrawal was successfully <a href=https://gnosisscan.io/tx/0x155499dd64a0340129144ce0e47e2549817ad72e95d5d2836bbbf7acbb0750dc>triggered</a> during an experiment where they purchased a coffee.</p><p>Here are two products or features that I think hold the most immense potential:</p><ol><li><p><em><strong>Allowing users to borrow and pay with stablecoins against their staking/restaking positions</strong> (just as Etherfi Cash is doing):</em></p><p>Staking is a cornerstone in the crypto world, often viewed as the equivalent of a risk-free rate. It offers simplicity and predictable yields, attracting a significant number of participants and substantial assets. Many stakers, especially large investors (whales), might appreciate having a card for everyday use.</p><p>It might sound like a credit card, but can be uniquely structured by incorporating a liquidity pool model between users and issuers. This way, issuers wouldn&rsquo;t need to use their own funds for transactions, allowing assets to be settled promptly.</p><p>Alternatively, we could leverage existing lending protocols like AAVE or Compound. The Holyheld team has conducted internal tests for credit lines using wstETH (Lido) and AAVE&rsquo;s V3 delegation module. While the system functions as intended, there&rsquo;s a significant limitation: AAVE&rsquo;s credit delegation only supports an &ldquo;all or nothing&rdquo; approach. This means it&rsquo;s impossible to delegate just a portion of the position or a specific amount. Compound faces the same issue.</p></li><li><p><em><strong>Allowing users to hold and pay with (risk-free) yield-bearing assets:</strong></em></p><p>It&rsquo;s ironic that most crypto users - from retail investors to most professional institutions - continue to lend funds to Tether and Circle without receiving any yield in return. In a highly digitalized world, users should be experiencing more transparency and fairness, not continued exploitation by centralized entities. RWAs, particularly yield-bearing stablecoins, are poised to iterate on the current ones. The importance of a risk-free, yield-bearing stablecoin cannot be overstated, as bonds and treasuries have long been the go-to investment vehicles in many parts of the world. These are highly standardized, easy to understand, and backed by sovereign nations. Many people hold USDT or USDC as a digital alternative to the dollar, primarily because it offers better protection against inflation than the fiat currency of their own country. Naturally, these users would also want to earn a risk-free interest rate on their holdings. However, adoption remains low, and this can be attributed to two main factors:</p><ul><li><p><strong>On-chain challenges:</strong> The current standards for yield-bearing tokens are not easily integrated into existing systems, creating friction.</p><p>For a token to be considered a stablecoin, its value must remain stable, but the assets backing these RWA protocols, like treasuries and bonds, appreciate over time. To pass this value back to users while keeping the token price stable, many yield-bearing stablecoins, such as USDM by Mountain and STBT by Matrixport, use a rebase token model. This model adjusts all holders&rsquo; balances proportionally using a <span style=color:#d73504><code>rebaseFactor</code></span> to reflect the accrued value. Although it&rsquo;s a neat design, it has yet to gain widespread support from Defi protocols, wallets, and centralized exchanges, where the simpler ERC-20 standard still dominates. Additionally, these protocols typically trigger the rebase process once a day, which can create arbitrage opportunities for traders and lead to price fluctuations that many users find undesirable. One possible solution is to stream rewards on a block-by-block basis, which could help smooth out price fluctuations. However, this approach would incur significant gas costs, and the potential for arbitrage would still remain.</p></li><li><p><strong>Off-chain Challenges:</strong> Issuing these types of assets could potentially expose projects to significant legal risks, particularly from the SEC, as they may be deemed &ldquo;unregistered securities.&rdquo;</p><p>This is why many of these projects explicitly exclude U.S. residents or citizens from their services. These protocols often invest considerable time and resources in developing legal frameworks to ensure that users can retrieve their assets even if the protocol itself fails (bankruptcy remote). However, until new legislation is passed or any precedent-setting case is decided, the legal outlook for these projects remains uncertain.</p></li></ul><p>Another key factor in establishing a widely adopted stablecoin is building a comprehensive, globally distributed banking support network. While on-ramping is important, ensuring a smooth off-ramp process for merchants or institutions is even more critical. Tether achieves this through a network of distributors, while Circle leverages its compliance and strong relationships with various banks. New entrants into the market will need to determine their own strategies. For RWAs, gaining access to deep liquidity, such as that offered by firms like BlackRock, could be crucial.</p></li></ol><p>In the near future, payment systems will become seamlessly integrated into the entire Defi ecosystem. Individuals will have access to a wide range of investment vehicles, management tools, and strategies, all from a unified account.</p><p>Moreover, cryptocurrency payments will be increasingly integrated into traditional financial systems. Currently, issuing banks are the first to adopt cryptocurrency because they manage the initial stages of fund flow and are most downstream in the information flow. Once these issuers handle the conversion between crypto and fiat, other participants, such as card networks and acquiring banks, can operate without needing to be aware of the cryptocurrency involved.</p><p>However, in the long term, we can expect cryptocurrency to be integrated further downstream in the fund flow - or, conversely, further upstream in the information flow - due to its efficiency and cost-effectiveness, with fewer conversions required. We&rsquo;ve already seen Visa and MasterCard actively exploring the integration of crypto into their networks and traditional payment rails, signaling a definitive shift in the industry. Similarly, Stripe&rsquo;s <a href=https://x.com/jeff_weinstein/status/1844080628427620642>recent move</a> to enable stablecoin payments further underscores this trend.</p><p>As cryptocurrency adoption grows, more funds will remain on-chain for secure and convenient management, as well as to take advantage of better yield opportunities, with conversions to fiat occurring only when necessary.</p><h1 id=5-closing-thoughts>5. Closing Thoughts<a hidden class=anchor aria-hidden=true href=#5-closing-thoughts>#</a></h1><h2 id=51-how-should-crypto-payments-ideally-work>5.1 How should crypto payments ideally work?<a hidden class=anchor aria-hidden=true href=#51-how-should-crypto-payments-ideally-work>#</a></h2><p>While the exact future remains uncertain, we can envision an ideal scenario based on current knowledge and trends.</p><p>In the future, the process of making crypto payments should be as seamless and quick as today&rsquo;s digital payments. Customers would only need to engage in a brief interaction with the merchant, similar to how we currently use QR codes, NFC, or biometric authentication. This simple interaction would allow the merchant to identify the user&rsquo;s abstracted or smart account, powered by the primitives discussed in section 3.2.1.</p><p>A payment processor, serving as one of the few intermediaries in this streamlined system, would handle a range of security checks on behalf of the merchant and the user. These checks might include identity verification, balance confirmation, AML compliance, fraud detection, and access control, among others. Once these checks are successfully completed, the payment request would be routed to the user&rsquo;s smart account.</p><p>This smart account could be used to hold a variety of assets, such as those related to staking, liquidity provision, RWA, CeDefi products, or other yield-generating opportunities and their combinations. Importantly, these assets would remain non-custodial, fully controlled by the user. Pre-authorization and access control would be defined and granted through smart contracts, with gas fees often being covered by the app or service provider.</p><p>To ensure speed and security, the system could leverage resource locks, fast confirmations, or high-performance chains. This would enable payment processors or other service providers to confirm transactions almost instantly, minimizing the risk of malicious activity. The merchant would receive immediate notification of the transaction&rsquo;s completion status, while the actual settlement of funds could occur either instantly or at a later time. Ultimately, the corresponding assets would be transferred to the merchant&rsquo;s account, closing the transaction.</p><p><span style=color:#0e97cb><em>(Ideal) Crypto Payment Flowchart</em></span></p><div align=center><img src=/The_Last_Big_Thing/pic14.png></div><p>As you may have noticed, in addition to the payment processor, another third party that users and merchants will likely need to rely on is the account service provider or manager. This necessity arises because basic native accounts, such as EVM EOAs, are insufficient for delivering the smooth experience and complex management. Moreover, a purely open-source solution may struggle to keep pace with the rapid evolution of blockchain technology and the changing needs of users.
A key advantage of crypto payments, which helps minimize the number of intermediaries and thus reduces costs, is that <em><strong>blockchain unifies the flow of funds and information within a single ledger</strong></em>.</p><h2 id=52-unification-democratization-and-disintermediation>5.2 Unification, Democratization, and Disintermediation<a hidden class=anchor aria-hidden=true href=#52-unification-democratization-and-disintermediation>#</a></h2><p><span style=color:#0e97cb><em><strong>Payment Eras</strong></em></span></p><div align=center><img src=/The_Last_Big_Thing/pic15.png></div><p>To summarize the entire article:</p><p>Card payments marked the beginning of the digitalization of financial transactions, leveraging computers and the internet for bookkeeping and information transmission. As the payment industry grew and technology advanced, the process involved an increasing number of specialized intermediaries. Digital payments furthered this digitalization by utilizing emerging technologies as consumer internet usage became widespread. It also disintermediated the traditional process by abstracting away customers&rsquo; direct interactions with banks.</p><p>Blockchain and crypto payments take this disintermediation a step further, offering a system where users retain control of their assets while gaining access to a wide array of composable yield opportunities and asset management tools. This technology provides a decentralized and permissionless network, making digital assets and ownership accessible to nearly everyone on the planet. It fosters a transparent and neutral environment where all parties can collaborate without needing to establish trust beforehand.</p><hr><p><em>Disclaimer: The views, information, and opinions expressed in this article are solely my own and do not reflect the official position of my employer or its affiliates. This post is for informational purposes only and should not be construed as investment, financial, legal, or tax advice. Nothing contained herein constitutes an offer to sell, a solicitation of an offer to buy, or a recommendation for any digital asset or investment. The information presented is subject to change without notice and makes no representation about the accuracy, completeness, or timeliness of the content.</em></p><hr></div><footer class=post-footer><nav class=paginav><a class=prev href=http://localhost:1313/writings/cross-border-payment--stables/><span class=title>« Prev</span><br><span>一些关于稳定币在跨境贸易中应用的笔记</span>
</a><a class=next href=http://localhost:1313/writings/the-last-big-thing-part2/><span class=title>Next »</span><br><span>The Last Big Thing - Crypto Payment Part2</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=http://localhost:1313/>Larry007's</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>