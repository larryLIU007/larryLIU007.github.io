<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>The Last Big Thing - Crypto Payment | Larry007's</title>
<meta name=keywords content="Sector"><meta name=description content="—— It's not happening until we build it."><meta name=author content="Larry007"><link rel=canonical href=https://canonical.url/to/page><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.1589d2fd43d375d4c2ff70ef778072642369f65f393a93e7f608e91442d443c1.css integrity="sha256-FYnS/UPTddTC/3Dvd4ByZCNp9l85OpPn9gjpFELUQ8E=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/favicon16.png><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/favicon32.png><link rel=apple-touch-icon href=http://localhost:1313/appletouch.png><link rel=mask-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://localhost:1313/writings/the-last-big-thing/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="The Last Big Thing - Crypto Payment"><meta property="og:description" content="—— It's not happening until we build it."><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/writings/the-last-big-thing/"><meta property="og:image" content="http://localhost:1313/writings/the-last-big-thing/%3Cimage%20path/url%3E"><meta property="article:section" content="writings"><meta property="article:published_time" content="2024-10-24T11:30:03+00:00"><meta property="article:modified_time" content="2024-10-24T11:30:03+00:00"><meta property="og:site_name" content="Larry007's"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://localhost:1313/writings/the-last-big-thing/%3Cimage%20path/url%3E"><meta name=twitter:title content="The Last Big Thing - Crypto Payment"><meta name=twitter:description content="—— It's not happening until we build it."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Writings","item":"http://localhost:1313/writings/"},{"@type":"ListItem","position":2,"name":"The Last Big Thing - Crypto Payment","item":"http://localhost:1313/writings/the-last-big-thing/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"The Last Big Thing - Crypto Payment","name":"The Last Big Thing - Crypto Payment","description":"—— It's not happening until we build it.","keywords":["Sector"],"articleBody":"1. Introduction Over time, I came to believe that value transfer remains the most significant and compelling use case for blockchain technology in the foreseeable future, aligning with its original vision.\nAs the industry collectively yearns for practical applications rather than further infrastructural developments, I’ve dedicated the past few months to an intensive exploration of this particular sector. I would like to share these learning notes with the audience, in the hope that they might prove helpful. This article traverses the landscape of traditional payment systems, scrutinizes the current state of affairs, and explores the revolutionary possibilities unleashed by blockchain technology.\nI’m deeply grateful for the invaluable support from: @niarbnotna, @YinghuanCui, @gizmothegizzer, @ryanberckmans, @JimsYoung_, and @sui414.\nSpecial appreciation to all the friends at @holyheld, @Fiat24Official, @WSPNpayment, @Kun_sight, @Qbit_Neobank, @RedotPay, @gnosispay, and @Transak - your insights have been instrumental!\n2. Evolution of payment 2.1 Card payments 2.1.1 The origin of credit card and the enablers One night in 1949, Frank X. McNamara, a New York City businessman, was dining at a restaurant named Major’s Cabin Grill, and soon realized he had forgotten his wallet. As a result, he had to call his wife to bring cash for the bill. This embarrassing incident inspired him to create a single card that could be used to make purchases at various establishments.\nIn 1950, McNamara founded Diners Club and issued the first credit card to 200 prosperous businessmen and merchants in New York. The cardholders could use the Diners Club card to pay for meals at participating restaurants, and the merchants would then be reimbursed by Diners Club, minus a service charge.\nDiners Club Credit Card In The Early Days\nThe Diners Club card was an instant success, and the concept quickly spread to other companies and industries:\nIn 1958, American Express launched their own credit card product to compete with Diners Club in the travel and entertainment market. In 1966, the Interstate Credit Card system, later renamed Master Charge (now Mastercard), was formed by a group of banks to enable a universal credit card that could be used at numerous merchants. Also in 1966, Bank of America launched the BankAmericard, which later became Visa, as a licensed franchise issued by various banks. In 1969, an association of regional bankcard programs formed the Interbank Card Association, which became Mastercard International in 1979. The introduction of these bank-issued, all-purpose credit cards expanded the credit card market rapidly in the 1960s and 1970s. Competition grew fierce as these companies and banks engaged in aggressive marketing to sign up merchants and consumers. Rewards programs, annual fees, interest rates and other features were developed over time. Credit cards evolved from a product for travel and entertainment to a widely used payment method for all types of consumer purchases, and gradually became an integral part of the financial system.\nNevertheless, it is important to note that the widespread adoption is inherently intertwined with the progress of technology. The development of computer systems and telecommunications networks in the 1960s and 1970s made all these possble, through enabling the efficient processing and authorization of card transactions on a large scale.\nPrior to the advent of computer systems and telecommunications networks, processing card transactions was a manual and cumbersome process. When a customer made a purchase with a card, the merchant had to call the issuing bank to verify the customer’s credit limit and obtain authorization for the transaction. This process was time-consuming, inefficient, and limited the scalability of card payments.\nThe computerization of financial systems and the development of telecommunications networks enabled the automation of card payment processing, including:\nElectronic data capture at points-of-sale (POS), eliminating manual entry and errors. Efficient transmission of transaction data between merchants, banks, and card issuers through telecommunication networks like leased lines and the internet. Automated, near-real-time authorization of transactions through computerized systems that could quickly access customer data and credit limits. Batch processing and clearing of large transaction volumes between financial institutions. Scalability, speed, and accuracy required to handle widespread card payment adoption across a growing base of merchants and consumers. These technological advancements laid the foundation for the modern electronic payment infrastructure, transforming card payments from a manual, localized process into a highly efficient, automated, and globally interconnected system, paving the way for their widespread use in retail, online, and various other commerce sectors.\n2.1.2 How does it work nowadays Nowadays card payments work through a series of steps involving the customer, the merchant, the merchant’s bank (acquiring bank), and the card network and customer’s card-issuing bank.\n👈Click to see details on how card payments work Authorization: The customer presents their credit or debit card to the merchant for payment. The merchant sends a request to their payment processor or gateway, including the card details and transaction amount. The payment processor forwards the request to the card network (e.g., Visa, Mastercard). The card network routes the request to the issuing bank (the customer’s bank). The issuing bank verifies the card details, checks for sufficient funds or credit, and approves or declines the transaction. The response is sent back through the card network and payment processor to the merchant. Capture: If the transaction is approved, the merchant receives an authorization code. The merchant completes the sale and captures the transaction, typically at the end of the day or in batches. The merchant sends the captured transactions to their payment processor. Clearing and Settlement: The payment processor sends the captured transactions to the card network for clearing. The card network facilitates the exchange of funds and transaction information between the issuing bank and the acquiring bank (the merchant’s bank). The issuing bank deducts the transaction amount from the customer’s account. The acquiring bank receives the funds and credits the merchant’s account, minus any applicable fees. Funding: The merchant receives the funds in their account, typically within 1-3 business days after the settlement. During this process, multiple security measures are also implemented to safeguard sensitive card information and prevent unauthorized or illegal transactions. These measures include encryption, compliance checks, and fraud detection, etc.\nIt goes without saying that each participant involved in the process takes a small cut of the transaction. These fees can vary significantly depending on factors such as the type of card, the industry of the merchant, the transaction volume, and whether the transaction is conducted in person or online, etc. However, when combined, these fees can be surprisingly high. The general process and breakdown is illustrated in the diagram below.\nTypical Workflow Of Card Payments\nAs a consumer, you likely never notice the many fees involved because payment providers charge merchants rather than customers directly. Over time, these providers have built a powerful network effect, resulting in most customers (particularly in America and Europe) using credit or debit cards as their main form of payment. Despite the high costs, merchants has little choice but to participate in these networks to offer their customers a seamless and convenient payment experience.\n2.2 From card payment to open banking 2.2.1 Digital payments came in Things have changed since the late 1990s when online payment platforms started to emerge with the widespread use of the internet and the growth of e-commerce. These platforms allow users to make payments quickly and easily from anywhere with an internet connection, eliminating the need for cash or checks. The proliferation of smartphones in the 2000s has further accelerated the adoption of these platforms, as more customers have grown accustomed to the convenience of seamless digital payment experiences.\nPayPal was launched in 1998, which soon became the dominant player in the early 2000s, and the introduction of Alipay in China in 2004, which has since become the world’s largest mobile and online payment platform. In 2010, Stripe arrived, simplifying payment processing for businesses worldwide. The mobile era ushered in new players, with Apple Pay in 2014 and Google Pay in 2015 turning smartphones into digital wallets, changing how millions pay both online and in stores.\n👈Click to see details on how digital payment works Checkout initiation: When a user is ready to make a purchase, they select their preferred payment method (online or mobile) and initiate the checkout process. If the user is not already logged in, they may be prompted to sign in or create an account. Payment method selection: The user chooses their preferred payment method from the options they have previously set up, such as a credit card, debit card, or mobile wallet. Authentication: The user authenticates the transaction using security measures like passwords, PINs, or biometric data (e.g., fingerprint or facial recognition for mobile payments). Payment processing: The payment service provider securely processes the transaction, either verifying that the user has sufficient funds in their account, or communicating with the user’s bank or card issuer to verify and authorize the payment. Fraud detection measures are applied during this step. Confirmation and receipts: Once the payment is processed, both the user and the merchant receive confirmation of the transaction. Digital receipts may be sent via email or stored within the payment platform’s interface. Digital payments act as a form of disintermediation relative to traditional card payments. Money from both users and merchants slowly builds up in the e-wallet, creating a fund pool. They rarely interact directly with the traditional payment systems anymore. Instead, transactions are simply internal bookkeeping entries, transferring amounts from one balance to another. This bypasses some of the previous intermediaries, and transactions are now essentially processed in “batches”. Moreover, these platforms offer financial products and yield opportunities to their customers, leveraging these funds while taking a commission.\nTypical Workflow Of Digital Payments\nMore importantly, the move toward digital payments, as the name suggests, is a digitalization process. Many of its benefits are (again) made possible by emerging technologies:\nPrevailing of mobile devices and internet -\u003e Convenience and Accessibility The ubiquity of smartphones, user-friendly apps, and expansive internet and mobile networks make digital payments convenient and accessible, driving financial inclusion. Adoption of tokenization and biometric authentication -\u003e Enhanced Security Implementing tokenization and biometric authentication significantly improves digital payment security compared to traditional card payments. Utilization of cloud computing and digital infrastructure -\u003e Reduced Costs Leveraging cloud computing and digital infrastructure streamlines transaction processing, minimizing the need for physical infrastructure and reducing fraud-related costs. Advancement in interoperability and integration -\u003e Seamless User Experience APIs, SDKs, and web services, allow digital payment platforms to seamlessly integrate with various digital services, enhancing user experience and encouraging widespread adoption. Harnessing big data analytics and AI -\u003e Expanded Business Opportunities Payment companies employ big data analytics and AI to gain valuable customer insights, develop targeted strategies, and expand their market presence. 2.2.2 Cutting-edge technology spreads more quickly in less developed areas Interestingly, most advanced payment technologies tend to spread more quickly in relatively less developed countries.\nPOS Payment Methods By Volume\nData Source: Global Payments Report 2024, Worldpay\nWorldpay’s report highlights two key trends:\nMore developed regions generally have higher rates of cashless transactions due to better access to advanced technologies and stronger economic foundations, enabling quick adoption of new paradigms for improved convenience and efficiency. Less developed regions are increasingly adopting digital payments. This contrasts with North America and Europe, where payment markets are mature and customers are used to card payments. In these established markets, the convenience of digital payments barely outweighs the costs of switching. Plus, established companies use various tactics to keep their market share, showing how resistant large-scale payment systems can be to change. This raises an interesting question about crypto payment adoption: Where would it be most effective? In developed countries, and places like China and India, widespread internet access and sophisticated financial systems are already in place. Here, cryptocurrencies offer benefits related to financial independence and privacy, as well as investment opportunities, but these are generally seen as nice-to-have features rather than essentials. On the flip side, in many other parts of Asia, Latin America, and Africa, where inflation is high or large segments of the population lack access to banks and payment platforms, crypto could significantly enhance the convenience and efficiency of financial transactions.\nDaily crypto purchasing with ARS (Argentine Peso) vs. ARS value\nSource: The 2023 Global Crypto Adoption Index, Chainalysis\nSurprisingly, crypto, particularly stablecoins, is already gaining traction in various regions. In Argentina and Turkey, people use cryptocurrencies as a hedge against inflation, with about half of Turkey’s youth owning some form of crypto. In the Philippines and Vietnam, cryptocurrencies facilitate remittances, helping workers abroad send money home efficiently. The Philippine central bank even introduced a stablecoin linked to the peso to promote financial inclusion. Across African cities, from Lagos to Nairobi, small and medium-sized businesses are increasingly accepting cryptocurrencies, reducing cross-border transaction fees from as much as 15% to between 1% and 3%.\n8 Of The Top 10 Countries Leading In Crypto Adoption Are From Less-developed Regions\nSource: The 2023 Global Crypto Adoption Index, Chainalysis\n3. Entering Crypto Payments 3.1 Edges And Reasons So why are crypto and blockchain beneficial?\n3.1.1 Democratized Access 1️⃣ Public blockchains democratize access to digitalized assets and ownership through their permissionless and decentralized networks. Node operators benefit from diverse source of revenues, enabling them to serve a broad audience that traditional banking and payment systems fail to reach.\nTraditional digital payment systems have already driven the marginal cost of serving an additional customer to nearly zero. In contrast, public blockchains usually have extra overhead due to communication costs and redundant work done by multiple nodes. However, node operators largely benefit from token issuance and other diverse revenue sources instead of relying solely on transaction fees.\nTaking Ethereum node revenue as an example:\nCurrently:\nConsensus Layer Reward Token issuance - 82.5% Execution Layer Reward Priority gas fees (processing fees) - 11.7% Baseline MEV - 5.9% Ethereum Node Revenue Breakdown\nSource: Rated Network\nOver the past 30 days, token issuance alone has accounted for 82.5% of a node’s revenue, while priority gas fees - similar to payment processing fees in traditional systems - only contribute 11.7%. Although a 3.42% return rate may seem modest, it’s denominated in ETH and the risks are fairly low. The scale of funds involved is significant, with around 33 million ETH staked, equating to over $100 billion - about 3.7‰ of the US GDP in 2023 or equivalent to the total US treasury bonds outstanding - all earning a 3%+ yield denominated in ETH annually. Looking ahead, revenue sources are expected to diversify further, with non-issuance rewards comprising a larger share.\nThese enriched revenue streams and high-value transactions make operating nodes a lucrative business, especially when done professionally. While some argue that L2s may not benefit from PoS staking, launching their own tokens, internalizing gas fees, and potentially earning MEV income could easily offset the disadvantages.\nWe further delve into the concentration of revenue at the transaction level. The data reveals that the top four transaction types contribute over 60% of the total MEV, yet they occupy only about 22% of the block space, measured by gas spent. These transaction types - Telegram Bot Flow, Sandwich MEV, Bot Swap Flow, and Non-Atomic Arbitrage MEV (essentially CEX-DEX arbitrage) - are primarily associated with trading rather than transfers or other activities. These sophisticated trading operations contribute significant economic rewards to node operators who maintain and secure the network infrastructure. In tandem with technical composability, this has produced a decentralized network serving a much wider audience across borders than ever before.\nOrder Flow Breakdown\nSource: ‘Who Wins Ethereum Block Building Auctions and Why?’ by Burak Öz, Danning Sui, Thomas Thiery, Florian Matthes\n3.1.2 Neutral And Transparent Environment 2️⃣ Public blockchains excel at eliminating the trust assumptions, and thus the frictions of cross-party collaborations. Essentially, they provide a neutral and transparent environment ensured by trustless data processing and computation.\nIf you have a deposit account with a bank in the US and want to send money to your family in Southeast Asia using a local bank account. You have a few options, but none are ideal. Traditional bank transfers typically take 3-5 days and come with fees ranging from 1-5%. Money transfer services can complete the transfer much faster - often within minutes or hours - but at a higher cost, typically between 5-10%. Even most online services, which are more convenient, usually only manage to transfer funds within 1-2 days, with fees ranging from 0.5-2%. Additionally, FX markups can add another 0.5-5% depending on the provider and other factors.\nThe primary reason for these lengthy and costly processes is that different banks and countries operate on separate “ledgers”. Each bank maintains its own booking system, and even global banks usually keep separate ledgers for different regions or countries. Currently, SWIFT serves as the primary messaging network that banks use to route global remittances. When you initiate a transfer, your bank debits your account and sends a message through SWIFT to the receiving bank. The receiving bank then processes this message and credits the recipient’s account. If the two banks don’t have a direct relationship, they must rely on one or more intermediary banks to route the messages and funds. These intermediary banks may be in different time zones, have varying levels of digital infrastructure, and follow their own procedures and policies. Some banks prefer to process international transfers in batches rather than in real time. All these factors contribute to significant delays and increased costs.\nA similar situation unfolds daily across nearly every industry. Whether it’s individuals, companies, organizations, regions, or entire countries, each party operates with its own interests in mind - collaborating when beneficial, but also competing with one another. Economic theories often suggest that this dynamic fosters optimal efficiency and sustains a vibrant society. However, it also undeniably gives rise to countless instances of the prisoner’s dilemma, tragedy of the commons, and walled gardens. These dynamics introduce significant frictions in cross-party collaborations, often making such interactions complex, costly, and, in some cases, prohibitively difficult.\nBlockchain offers a transformative approach by treating all participants equally and ensuring that every node maintains the exact same ledger, i.e., the canonical chain. Through a rigorous consensus mechanism and a cryptographically secured account system, blockchain guarantees that all applications and accounts operate strictly according to open-source coded rules. This framework allows a user to manage a single account from any location and transfer funds to anyone, anywhere, within seconds.\nA bank “on chain” can directly communicate with other banks because they all operate on the same transparent ledger. This ledger is not only universally accessible but also verifiable by any participant, eliminating the need for trust and reducing waiting times. With blockchain, a farmer in rural China can make secure, trustless transactions with a financial service provider in a skyscraper on Wall Street. This is the power of blockchain: it removes barriers, enhances transparency, and democratizes access to financial and other services on a global scale.\n3.2 Status Check Despite its promising potential, crypto payments are still in the early stages of development and face significant challenges. These challenges include the rigidity of large-scale payment systems, resistance from established user habits, and the entrenched interests of existing financial giants. While Satoshi envisioned Bitcoin as a widely used form of digital cash, most goods and services in our daily lives are still priced in fiat currency. Therefore, the focus here is primarily on stablecoin payments.\n3.2.1 Only Adding Extra Steps On Top Paradoxically, many current crypto payment solutions introduce additional layers on top of traditional payment methods. Take crypto cards, the most common product in this space, as an example.\nTypical Workflow Of Current ‘Crypto Payment’\nAlthough it’s often suggested that crypto payments might first gain traction in less developed areas with limited access to traditional banking and cards, I see it as more practical - and symbolically significant - to start with cards, given the current stage of the industry. The key strategy here is to leverage existing Visa and MasterCard networks, which together cover over 150 million merchants in more than 200 countries and territories. Without this approach, we would face the daunting task of convincing individual merchants to adopt a new payment method or persuading existing payment platforms to integrate with crypto systems - neither of which seems practical at this stage.\nThe early adopters in this space are typically card issuers or entities partnering with card issuers to borrow their issuing capabilities (via BIN sponsorship). When issuers promote the ability to spend crypto with their cards, the process typically involves converting crypto to fiat in advance. This is often done either through an off-ramp provider or managed by the issuer on the user’s behalf. Once this process is complete, you can use the card for payments, which are effectively conducted in fiat currency and have little to do with crypto.\nIn this context, credit cards are fully backed by assets and are referred to as “secured credit cards.” This blurs the line between credit and debit cards, making the distinction between them minimal. While credit cards, debit cards, prepaid cards, and other payment forms do differ in terms of spending limits, use cases, and fee structures - and these differences can vary by country and region - the focus here is on card payments in general, without getting into the specific nuances of each type.\nThis approach does accommodate native crypto users to some extent, particularly those who hold a significant portion of their assets in crypto but still need to use fiat for everyday expenses. However, it is far from ideal and has several significant flaws:\nCustody and Centralization Risks: During the period between funding the card and making a payment, users’ assets are effectively under custody, either with the issuers or specialized custody providers. This introduces potential centralization risks and complicates account management. Users must actively maintain their fiat account balances and are exposed to the risk of something going wrong on the custody side. Additionally, there’s an opportunity cost, as users miss out on the potential yield that could have been earned on-chain through staking or other Defi protocols. While some issuers are beginning to offer yields to users, this typically involves lending funds to a portfolio manager, which introduces additional risks and costs. Increased Complexity and Costs: Contrary to the original promise of simplifying transactions and reducing intermediaries, this approach actually adds more steps and middlemen to the payment process. Currently, service providers typically charge 1%-3% just for topping up cards, and this cost is directly borne by the cardholders. 3.2.2 What Prevents Non-custodial Payments Given these issues, the question arises: Why can’t users simply sign the payment transaction in real time? Why does off-ramping in advance seem necessary so far?\nProvider Side:\nLatency: When using traditional payment rails, card issuers are required to confirm a payment within approximately 5 seconds to ensure a smooth user experience and mitigate potential security risks. On L1s like Ethereum, this time frame is insufficient even to confirm the transaction’s inclusion in a block, let alone achieving finality. Double Spending: While real-time authorization is technically feasible on L2s or highly performant L1s, several risks remain. A transaction could be reverted due to various issues such as chain re-orgs or network outages. Transactions that are pre-confirmed by rollup sequencers might be inadvertently or deliberately omitted. Moreover, sophisticated attackers could potentially overwrite their own transactions by bidding higher gas fees, allowing them to move assets to another address before the original transaction is finalized. The most significant risk faced by payment providers or card issuers in a non-custodial payment system is the possibility of not receiving the tokens as expected, in which case the provider would need to cover the shortfall with their own funds.\nAttackers Grief Providers Through Double Spending\nUser Side:\nGas Fees: One of the significant challenges for users in a crypto payment system is gas fees. On L1s, the gas fees can be prohibitively expensive, and even on L2s or cheap L1s, where gas fees are considerably lower, the costs can still be unacceptable for high-frequency, low-value transactions like daily payments. Signing and Managing: Up to this point, signing transactions with a card swipe has not been supported. Instead, users have had to manually sign each transaction using their phones or hardware wallets, which is far from ideal. Additionally, the process of signing and key management on mobile devices has been neither smooth nor secure. Furthermore, fine-grained access control is often expected, particularly by enterprise clients. Is it possible to offer solutions that address all these issues? With the introduction of several new primitives, the answer is now yes.\n3.2 Trends 3.2.1 The Rise of Non-custodial Solutions In the past two years, numerous innovative account designs have emerged, gradually dismantling previous barriers. Soon, users will no longer need to convert their crypto into fiat currency in advance.\nResource Lock - Instruments to prevent double spending\nImplementations: MPC, TEE, Smart Contract, etc.\nIssues solved: Double Spending, Latency\nA resource lock is an instrument designed to help users make credible commitments regarding their account activities. It allows users to ensure that their account will or will not engage in specific behaviors, potentially based on certain conditions. One of the most common applications is preventing double spending, where users can credibly ensure they won’t spend the same assets in their account more than once. This assurance allows service providers to proceed with the next steps even before the transaction is fully settled or finalized.\nResource Lock Can Improve UX By Large\nI borrowed the term from Frontier’s research article, but these implementations have been widely used in the industry long before One Balance was introduced.\nCase1 - StablesMoney\nFor example, Stables Money, an Australian-based card issuer, keeps users’ funds on-chain until payments are made. Stables utilizes MPC wallets, where private keys are split into three shards managed separately by the users, Stables, and Fireblocks, one of the largest custody providers. When a payment is initiated, Stables facilitates co-signing, initiates the transaction, and confirms it with the card network instantly. Meanwhile, they update the user’s balance in their own database even before the transaction is finalized on-chain. When the user initiates a subsequent transaction, Stables checks the user’s balance against their internal records, rejecting any double spending attempts. Under this setup, the only way for users to double spend is by bypassing Stables and colluding with Fireblocks within a short window, which is highly unlikely. However, this approach is still centralized, and theoretically, Stables and Fireblocks could collude to steal users’ funds.\nCase2 - Gnosis Pay\nGnosis Pay takes a different approach, prioritizing decentralization over efficiency. In Gnosis Pay’s system, transactions are categorized into card transactions and non-card transactions, with the latter typically initiated directly through wallets by users. Card transactions are confirmed instantly, while non-card ones are subject to a delay - a three-minute waiting period, during which time any previously initiated card transaction is usually settled and notified to the providers already. This design choice also helps mitigate the risk of a malicious double spending effectively.\nGnosis Pay implemented this method by adding a “delay module” developed by Zodiac on top of a standard SAFE account. This solution is subtle and elegant but also very specific, which results in limited efficiency and flexibility. For example, if a user needs to quickly reallocate funds to prevent a liquidation, a three-minute waiting period could be fatal. It’s also worth mentioning that this type of transaction processing doesn’t support all card transactions, such as complex reversals or delayed refunds.\nA resource lock can also be programmed to operate under specific conditions. For instance, in the cross-chain NFT purchasing scenario mentioned by Frontier, the locked funds could either be claimed by any solver who presents a valid fulfillment proof or be returned to the user after a set expiration period. Nowadays the cross-chain transaction experience has improved significantly between L2s and fast chains, but with a resource lock, waiting times can be minimized, even when bridging from the mainnet.\nresource_lock: { lock: 1500 USDC, fulfill: DeGods #12345, expiry: Solana block 245547084 } Source: Frontier Tech\nThis example demonstrates that a resource lock has versatile applications and should not limited to payments or cross-chain transactions alone.\nAnother implementation method that is certainly worth exploring involves leveraging TEEs. Within TEE, a resource lock would be fully programmable and highly efficient. By incorporating a decentralized network and robust attestation mechanisms, many of the concerns related to centralization and collusion could be alleviated. If implemented correctly, this approach could also achieve a high degree of security.\nResource locks may introduce additional trust assumptions, but when properly implemented, they have the potential to unlock a myriad of use cases that are currently infeasible and significantly enhance the user experience. The greatest advantage of this concept lies in its ability to allow the next action to proceed as if the previous one has already been completed, thereby eliminating many of the frictions that typically hinder user experience. Essentially, “it decouples fulfillment from settlement”, said Frontier.\nA card issuer could confirm a transaction as though it has already been settled. A solver could advance funds to the user on the destination chain as if the assets were already locked on the source chain.\nImagine a future where not only users but also solvers, market makers, and other providers adopt resource locks with a uniform, interoperable standard. In such a scenario, the entire process - from initiating a transaction to routing, fulfilling, and confirming it - could occur in an instant. This would finally bring instant, low-cost, and enriched crypto usage experience on par with that of Web2.\nFast confirmation: Near-Instant Transaction Confirmations\nImplementations: High-performance chains, Pre-confirmation, etc.\nIssues solved: Double spending, Latency\nAnother approach to addressing finality and latency is to enable fast confirmations. One viable method is to develop high-performance, stable chains where even large volumes of transactions can be settled in real-time. When a transaction is settled within milliseconds, providers and merchants receive a definitive outcome instantly, making it extremely difficult for even sophisticated attackers to double spend or exploit the system. Teams like MegaETH and others are actively working on this front.\nAlternatively, on mainnet or based rollups, pre-confirmations could achieve similar results if implemented effectively. Pre-confirmation allows L1 proposers to opt into a new supply branch, allocating part of the block space and committing to include certain transactions in advance, before the entire block is constructed and broadcast across the network. Projects like Commit Boost, Luban, and Chainbound are among those undertaking the comprehensive design and engineering required to make this a reality.\nSmart Contract Accounts - Customized logic and enriched function defined by smart contracts\nImplementations: Zerodev, Particle, etc.\nIssues solved: Signing \u0026 Managing\nThe signing experience is generally straightforward when using crypto-native apps for payments, as a wallet is embedded, and transactions are signed when users select “pay now” or “transfer.” However, this becomes a challenge for non-custodial card designers, who must ask users to swipe their cards and approve transactions separately. Tangem is developing a product that combines a hardware wallet and a payment card, but this approach requires customized manufacturing, which increases costs.\nAdditionally, as the signature curve used by most of the mainstream blockchains today, Secp256k1, is not integrated or supported by most of the mobile manufactures, the private keys for EOAs are usually maintained and utilized at a software level, instead of leveraging dedicated secured enclaves used for modern key managements on mobile devices. That imposes extra risks for mobile payment app users.\nFurthermore, the signature curve used by most mainstream blockchains today, Secp256k1, is not integrated or supported by most mobile manufacturers. As a result, private keys for EOAs are typically managed at the software level rather than leveraging the secure enclaves used in modern mobile key management, which introduces additional risks for payment app users.\nThere is also a growing demand for fine-grained payment access controls. For example, enterprises may want to grant access to employees only during business trips, with specific spending limits. Parents might want to allow their children to use a card for specific purposes under certain limits.\nTo address these needs, smart contract accounts are being actively developed by various startups. These accounts enable users to delegate balance deductions to others on their behalf, with the ability to specify spending limits, time constraints, and other granular details.\nPay Master - Enabling gas payment for others or in alternative tokens\nImplementations: Biconomy Paymaster, Pimlico Paymaster, etc.\nIssues solved: Gas Fees\nAbstracting gas fees away from the user experience is crucial for making blockchain technology more accessible and user-friendly.\nSummarizing above into one chart:\nHurdles For Non-custodial Crypto Payment And Primitives That Help\n3.2.2 Integration with Defi Protocols Users are increasingly seeking payment products that seamlessly integrate with Defi protocols, offering yield opportunities and sophisticated asset management in a trustless manner.\nThe traditional payment system, despite its complexity, essentially only revolves around two basic instructions: debit and credit. As Holyheld describes in their whitepaper:\n“…In-between consumer and product there are numerous intermediaries each one of them executing, transmitting, or relaying a simple instruction. At each step, there is a reconciliation of debit and credit instructions. It is not possible to program or enrich such instructions…”\nTo access additional asset management tools and opportunities, users are forced to turn to separate institutions and third parties. This reliance on siloed, independently maintained ledgers introduces significant costs and frictions.\nDefi was created to address these issues. While still in its early stages, Defi has already introduced a variety of on-chain yield opportunities, including:\nStaking and restaking - Earning yield by helping to operate a blockchain or protocol. LP fees - Generating revenue by providing liquidity where depth or immediacy matters RWA - yield from redirecting on-chain funds to off-chain assets CeDefi - revenue from redirecting on-chain funds to off-chain strategies Moreover, we’re witnessing the development of numerous automation tools, combinations, derivatives, and strategies built on top of these protocols. The logical next step is to close the last mile by integrating payment applications with Defi protocols. This would allow users to store, manage, and spend their assets seamlessly and trustlessly within one single account.\nCase1 - Etherfi\nPartnering with Scroll, Etherfi recently launched a “real” credit card, which aligns perfectly with this mission. Currently, Etherfi is best known as an LRT protocol built on top of EigenLayer. However, with the introduction of Cash, users will gain the ability to borrow and spend stablecoins against their staking positions using Visa credit cards issued through the platform. The outstanding balances on these cards can be automatically paid off with the interest generated from their staking. Etherfi also offers Liquid, which provides vaults with automated Defi strategies. Users simply deposit their tokens, and behind the scenes, the vault allocates funds across various Defi positions.\nCase2 - RoboSaver In contrast, Onchainification Labs advocates for a non-custodial approach. They have released an alpha version of RoboSaver, a smart contract module designed for installation on the Safe smart account that underpins every Gnosis Pay card. This module allows users to deposit the idle balance into Defi protocols like Balancer or Aura, where it earns yield and collects swapping fees. When the card balance falls below a certain threshold, RoboSaver automatically withdraws assets from the pool to top up the card. The contracts have already been deployed, and a withdrawal was successfully triggered during an experiment where they purchased a coffee.\nHere are two products or features that I think hold the most immense potential:\nAllowing users to borrow and pay with stablecoins against their staking/restaking positions (just as Etherfi Cash is doing):\nStaking is a cornerstone in the crypto world, often viewed as the equivalent of a risk-free rate. It offers simplicity and predictable yields, attracting a significant number of participants and substantial assets. Many stakers, especially large investors (whales), might appreciate having a card for everyday use.\nIt might sound like a credit card, but can be uniquely structured by incorporating a liquidity pool model between users and issuers. This way, issuers wouldn’t need to use their own funds for transactions, allowing assets to be settled promptly.\nAlternatively, we could leverage existing lending protocols like AAVE or Compound. The Holyheld team has conducted internal tests for credit lines using wstETH (Lido) and AAVE’s V3 delegation module. While the system functions as intended, there’s a significant limitation: AAVE’s credit delegation only supports an “all or nothing” approach. This means it’s impossible to delegate just a portion of the position or a specific amount. Compound faces the same issue.\nAllowing users to hold and pay with (risk-free) yield-bearing assets:\nIt’s ironic that most crypto users - from retail investors to most professional institutions - continue to lend funds to Tether and Circle without receiving any yield in return. In a highly digitalized world, users should be experiencing more transparency and fairness, not continued exploitation by centralized entities. RWAs, particularly yield-bearing stablecoins, are poised to iterate on the current ones. The importance of a risk-free, yield-bearing stablecoin cannot be overstated, as bonds and treasuries have long been the go-to investment vehicles in many parts of the world. These are highly standardized, easy to understand, and backed by sovereign nations. Many people hold USDT or USDC as a digital alternative to the dollar, primarily because it offers better protection against inflation than the fiat currency of their own country. Naturally, these users would also want to earn a risk-free interest rate on their holdings. However, adoption remains low, and this can be attributed to two main factors:\nOn-chain challenges: The current standards for yield-bearing tokens are not easily integrated into existing systems, creating friction.\nFor a token to be considered a stablecoin, its value must remain stable, but the assets backing these RWA protocols, like treasuries and bonds, appreciate over time. To pass this value back to users while keeping the token price stable, many yield-bearing stablecoins, such as USDM by Mountain and STBT by Matrixport, use a rebase token model. This model adjusts all holders’ balances proportionally using a rebaseFactor to reflect the accrued value. Although it’s a neat design, it has yet to gain widespread support from Defi protocols, wallets, and centralized exchanges, where the simpler ERC-20 standard still dominates. Additionally, these protocols typically trigger the rebase process once a day, which can create arbitrage opportunities for traders and lead to price fluctuations that many users find undesirable. One possible solution is to stream rewards on a block-by-block basis, which could help smooth out price fluctuations. However, this approach would incur significant gas costs, and the potential for arbitrage would still remain.\nOff-chain Challenges: Issuing these types of assets could potentially expose projects to significant legal risks, particularly from the SEC, as they may be deemed “unregistered securities.”\nThis is why many of these projects explicitly exclude U.S. residents or citizens from their services. These protocols often invest considerable time and resources in developing legal frameworks to ensure that users can retrieve their assets even if the protocol itself fails (bankruptcy remote). However, until new legislation is passed or any precedent-setting case is decided, the legal outlook for these projects remains uncertain.\nAnother key factor in establishing a widely adopted stablecoin is building a comprehensive, globally distributed banking support network. While on-ramping is important, ensuring a smooth off-ramp process for merchants or institutions is even more critical. Tether achieves this through a network of distributors, while Circle leverages its compliance and strong relationships with various banks. New entrants into the market will need to determine their own strategies. For RWAs, gaining access to deep liquidity, such as that offered by firms like BlackRock, could be crucial.\nIn the near future, payment systems will become seamlessly integrated into the entire Defi ecosystem. Individuals will have access to a wide range of investment vehicles, management tools, and strategies, all from a unified account.\nMoreover, cryptocurrency payments will be increasingly integrated into traditional financial systems. Currently, issuing banks are the first to adopt cryptocurrency because they manage the initial stages of fund flow and are most downstream in the information flow. Once these issuers handle the conversion between crypto and fiat, other participants, such as card networks and acquiring banks, can operate without needing to be aware of the cryptocurrency involved.\nHowever, in the long term, we can expect cryptocurrency to be integrated further downstream in the fund flow - or, conversely, further upstream in the information flow - due to its efficiency and cost-effectiveness, with fewer conversions required. We’ve already seen Visa and MasterCard actively exploring the integration of crypto into their networks and traditional payment rails, signaling a definitive shift in the industry. Similarly, Stripe’s recent move to enable stablecoin payments further underscores this trend.\nAs cryptocurrency adoption grows, more funds will remain on-chain for secure and convenient management, as well as to take advantage of better yield opportunities, with conversions to fiat occurring only when necessary.\n4. Closing Thoughts 4.1 How should crypto payments ideally work? While the exact future remains uncertain, we can envision an ideal scenario based on current knowledge and trends.\nIn the future, the process of making crypto payments should be as seamless and quick as today’s digital payments. Customers would only need to engage in a brief interaction with the merchant, similar to how we currently use QR codes, NFC, or biometric authentication. This simple interaction would allow the merchant to identify the user’s abstracted or smart account, powered by the primitives discussed in section 3.2.1.\nA payment processor, serving as one of the few intermediaries in this streamlined system, would handle a range of security checks on behalf of the merchant and the user. These checks might include identity verification, balance confirmation, AML compliance, fraud detection, and access control, among others. Once these checks are successfully completed, the payment request would be routed to the user’s smart account.\nThis smart account could be used to hold a variety of assets, such as those related to staking, liquidity provision, RWA, CeDefi products, or other yield-generating opportunities and their combinations. Importantly, these assets would remain non-custodial, fully controlled by the user. Pre-authorization and access control would be defined and granted through smart contracts, with gas fees often being covered by the app or service provider.\nTo ensure speed and security, the system could leverage resource locks, fast confirmations, or high-performance chains. This would enable payment processors or other service providers to confirm transactions almost instantly, minimizing the risk of malicious activity. The merchant would receive immediate notification of the transaction’s completion status, while the actual settlement of funds could occur either instantly or at a later time. Ultimately, the corresponding assets would be transferred to the merchant’s account, closing the transaction.\n(Ideal) Crypto Payment Flowchart\nAs you may have noticed, in addition to the payment processor, another third party that users and merchants will likely need to rely on is the account service provider or manager. This necessity arises because basic native accounts, such as EVM EOAs, are insufficient for delivering the smooth experience and complex management. Moreover, a purely open-source solution may struggle to keep pace with the rapid evolution of blockchain technology and the changing needs of users. A key advantage of crypto payments, which helps minimize the number of intermediaries and thus reduces costs, is that blockchain unifies the flow of funds and information within a single ledger.\n4.2 Unification, Democratization, and Disintermediation Payment Eras\nTo summarize the entire article:\nCard payments marked the beginning of the digitalization of financial transactions, leveraging computers and the internet for bookkeeping and information transmission. As the payment industry grew and technology advanced, the process involved an increasing number of specialized intermediaries. Digital payments furthered this digitalization by utilizing emerging technologies as consumer internet usage became widespread. It also disintermediated the traditional process by abstracting away customers’ direct interactions with banks.\nBlockchain and crypto payments take this disintermediation a step further, offering a system where users retain control of their assets while gaining access to a wide array of composable yield opportunities and asset management tools. This technology provides a decentralized and permissionless network, making digital assets and ownership accessible to nearly everyone on the planet. It fosters a transparent and neutral environment where all parties can collaborate without needing to establish trust beforehand.\n","wordCount":"7365","inLanguage":"en","image":"http://localhost:1313/writings/the-last-big-thing/%3Cimage%20path/url%3E","datePublished":"2024-10-24T11:30:03Z","dateModified":"2024-10-24T11:30:03Z","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/writings/the-last-big-thing/"},"publisher":{"@type":"Organization","name":"Larry007's","logo":{"@type":"ImageObject","url":"http://localhost:1313/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="Larry007 (Alt + H)"><img src=http://localhost:1313/appletouch.png alt aria-label=logo height=35>Larry007</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/writings/ title=Writings><span>Writings</span></a></li><li><a href=http://localhost:1313/involvements/ title=Involvements><span>Involvements</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/>Home</a>&nbsp;»&nbsp;<a href=http://localhost:1313/writings/>Writings</a></div><h1 class="post-title entry-hint-parent">The Last Big Thing - Crypto Payment</h1><div class=post-description><strong><em>—— It's not happening until we build it.</em></strong></div><div class=post-meta><span title='2024-10-24 11:30:03 +0000 +0000'>October 24, 2024</span>&nbsp;·&nbsp;<a href=https://x.com/Larry_007__ target=_blank rel="noopener noreferrer">Larry007</a></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#1-introduction aria-label="1. Introduction">1. Introduction</a></li><li><a href=#2-evolution-of-payment aria-label="2. Evolution of payment">2. Evolution of payment</a><ul><li><a href=#21-card-payments aria-label="2.1 Card payments">2.1 Card payments</a><ul><li><a href=#211-the-origin-of-credit-card-and-the-enablers aria-label="2.1.1 The origin of credit card and the enablers">2.1.1 The origin of credit card and the enablers</a></li><li><a href=#212-how-does-it-work-nowadays aria-label="2.1.2 How does it work nowadays">2.1.2 How does it work nowadays</a></li></ul></li><li><a href=#22-from-card-payment-to-open-banking aria-label="2.2 From card payment to open banking">2.2 From card payment to open banking</a><ul><li><a href=#221-digital-payments-came-in aria-label="2.2.1 Digital payments came in">2.2.1 Digital payments came in</a></li><li><a href=#222-cutting-edge-technology-spreads-more-quickly-in-less-developed-areas aria-label="2.2.2 Cutting-edge technology spreads more quickly in less developed areas">2.2.2 Cutting-edge technology spreads more quickly in less developed areas</a></li></ul></li></ul></li><li><a href=#3-entering-crypto-payments aria-label="3. Entering Crypto Payments">3. Entering Crypto Payments</a><ul><li><a href=#31-edges-and-reasons aria-label="3.1 Edges And Reasons">3.1 Edges And Reasons</a><ul><li><a href=#311-democratized-access aria-label="3.1.1 Democratized Access">3.1.1 Democratized Access</a></li><li><a href=#312-neutral-and-transparent-environment aria-label="3.1.2 Neutral And Transparent Environment">3.1.2 Neutral And Transparent Environment</a></li></ul></li><li><a href=#32-status-check aria-label="3.2 Status Check">3.2 Status Check</a><ul><li><a href=#321-only-adding-extra-steps-on-top aria-label="3.2.1 Only Adding Extra Steps On Top">3.2.1 Only Adding Extra Steps On Top</a></li><li><a href=#322-what-prevents-non-custodial-payments aria-label="3.2.2 What Prevents Non-custodial Payments">3.2.2 What Prevents Non-custodial Payments</a></li></ul></li><li><a href=#32-trends aria-label="3.2 Trends">3.2 Trends</a><ul><li><a href=#321-the-rise-of-non-custodial-solutions aria-label="3.2.1 The Rise of Non-custodial Solutions">3.2.1 The Rise of Non-custodial Solutions</a></li><li><a href=#322-integration-with-defi-protocols aria-label="3.2.2 Integration with Defi Protocols">3.2.2 Integration with Defi Protocols</a></li></ul></li></ul></li><li><a href=#4-closing-thoughts aria-label="4. Closing Thoughts">4. Closing Thoughts</a><ul><li><a href=#41-how-should-crypto-payments-ideally-work aria-label="4.1 How should crypto payments ideally work?">4.1 How should crypto payments ideally work?</a></li><li><a href=#42-unification-democratization-and-disintermediation aria-label="4.2 Unification, Democratization, and Disintermediation">4.2 Unification, Democratization, and Disintermediation</a></li></ul></li></ul></div></details></div><div class=post-content><h1 id=1-introduction>1. Introduction<a hidden class=anchor aria-hidden=true href=#1-introduction>#</a></h1><p>Over time, I came to believe that <em><strong>value transfer</strong></em> remains the most significant and compelling use case for blockchain technology in the foreseeable future, aligning with its original vision.</p><p>As the industry collectively yearns for practical applications rather than further infrastructural developments, I&rsquo;ve dedicated the past few months to an intensive exploration of this particular sector. I would like to share these learning notes with the audience, in the hope that they might prove helpful. This article traverses the landscape of traditional payment systems, scrutinizes the current state of affairs, and explores the revolutionary possibilities unleashed by blockchain technology.</p><p>I&rsquo;m deeply grateful for the invaluable support from: <a href=https://x.com/niarbnotna style=color:#0e97cb>@niarbnotna</a>, <a href=https://x.com/YinghuanCui style=color:#0e97cb>@YinghuanCui</a>, <a href=https://x.com/gizmothegizzer style=color:#0e97cb>@gizmothegizzer</a>, <a href=https://x.com/ryanberckmans style=color:#0e97cb>@ryanberckmans</a>, <a href=https://x.com/JimsYoung_ style=color:#0e97cb>@JimsYoung_</a>, and <a href=https://x.com/sui414 style=color:#0e97cb>@sui414</a>.</p><p>Special appreciation to all the friends at <a href=https://x.com/holyheld style=color:#0e97cb>@holyheld</a>, <a href=https://x.com/Fiat24Official style=color:#0e97cb>@Fiat24Official</a>, <a href=https://x.com/WSPNpayment style=color:#0e97cb>@WSPNpayment</a>, <a href=https://x.com/kun_sight style=color:#0e97cb>@Kun_sight</a>, <a href=https://x.com/Qbit_Neobank style=color:#0e97cb>@Qbit_Neobank</a>, <a href=https://x.com/redotpay style=color:#0e97cb>@RedotPay</a>, <a href=https://x.com/gnosispay style=color:#0e97cb>@gnosispay</a>, and <a href="https://x.com/intent/follow?screen_name=transak" style=color:#0e97cb>@Transak</a> - your insights have been instrumental!</p><h1 id=2-evolution-of-payment>2. Evolution of payment<a hidden class=anchor aria-hidden=true href=#2-evolution-of-payment>#</a></h1><h2 id=21-card-payments>2.1 Card payments<a hidden class=anchor aria-hidden=true href=#21-card-payments>#</a></h2><h3 id=211-the-origin-of-credit-card-and-the-enablers>2.1.1 The origin of credit card and the enablers<a hidden class=anchor aria-hidden=true href=#211-the-origin-of-credit-card-and-the-enablers>#</a></h3><p>One night in 1949, Frank X. McNamara, a New York City businessman, was dining at a restaurant named Major&rsquo;s Cabin Grill, and soon realized he had forgotten his wallet. As a result, he had to call his wife to bring cash for the bill. This embarrassing incident inspired him to create a single card that could be used to make purchases at various establishments.</p><p>In 1950, McNamara founded Diners Club and issued the first credit card to 200 prosperous businessmen and merchants in New York. The cardholders could use the Diners Club card to pay for meals at participating restaurants, and the merchants would then be reimbursed by Diners Club, <em><strong>minus a service charge</strong></em>.</p><p><span style=color:#0e97cb><em>Diners Club Credit Card In The Early Days</em></span></p><div align=center><img src=/The_Last_Big_Thing/pic1.png></div><p>The Diners Club card was an instant success, and the concept quickly spread to other companies and industries:</p><ul><li>In 1958, American Express launched their own credit card product to compete with Diners Club in the travel and entertainment market.</li><li>In 1966, the Interstate Credit Card system, later renamed Master Charge (now Mastercard), was formed by a group of banks to enable a universal credit card that could be used at numerous merchants.</li><li>Also in 1966, Bank of America launched the BankAmericard, which later became Visa, as a licensed franchise issued by various banks.</li><li>In 1969, an association of regional bankcard programs formed the Interbank Card Association, which became Mastercard International in 1979.</li></ul><p>The introduction of these bank-issued, all-purpose credit cards expanded the credit card market rapidly in the 1960s and 1970s. Competition grew fierce as these companies and banks engaged in aggressive marketing to sign up merchants and consumers. Rewards programs, annual fees, interest rates and other features were developed over time. Credit cards evolved from a product for travel and entertainment to a widely used payment method for all types of consumer purchases, and gradually became an integral part of the financial system.</p><div align=center><img src=/The_Last_Big_Thing/pic2.png></div><p><em><strong>Nevertheless, it is important to note that the widespread adoption is inherently intertwined with the progress of technology.</strong></em> The development of computer systems and telecommunications networks in the 1960s and 1970s made all these possble, through enabling the efficient processing and authorization of card transactions on a large scale.</p><p>Prior to the advent of computer systems and telecommunications networks, processing card transactions was a manual and cumbersome process. When a customer made a purchase with a card, the merchant had to call the issuing bank to verify the customer&rsquo;s credit limit and obtain authorization for the transaction. This process was time-consuming, inefficient, and limited the scalability of card payments.</p><p>The computerization of financial systems and the development of telecommunications networks enabled the automation of card payment processing, including:</p><ol><li>Electronic data capture at points-of-sale (POS), eliminating manual entry and errors.</li><li>Efficient transmission of transaction data between merchants, banks, and card issuers through telecommunication networks like leased lines and the internet.</li><li>Automated, near-real-time authorization of transactions through computerized systems that could quickly access customer data and credit limits.</li><li>Batch processing and clearing of large transaction volumes between financial institutions.</li><li>Scalability, speed, and accuracy required to handle widespread card payment adoption across a growing base of merchants and consumers.</li></ol><p>These technological advancements laid the foundation for the modern electronic payment infrastructure, transforming card payments from a manual, localized process into a highly efficient, automated, and globally interconnected system, paving the way for their widespread use in retail, online, and various other commerce sectors.</p><h3 id=212-how-does-it-work-nowadays>2.1.2 How does it work nowadays<a hidden class=anchor aria-hidden=true href=#212-how-does-it-work-nowadays>#</a></h3><p>Nowadays card payments work through a series of steps involving the customer, the merchant, the merchant&rsquo;s bank (acquiring bank), and the card network and customer&rsquo;s card-issuing bank.</p><details><summary><i>👈Click to see details on how card payments work</i></summary><ol><li>Authorization:<ul><li>The customer presents their credit or debit card to the merchant for payment.</li><li>The merchant sends a request to their payment processor or gateway, including the card details and transaction amount.</li><li>The payment processor forwards the request to the card network (e.g., Visa, Mastercard).</li><li>The card network routes the request to the issuing bank (the customer&rsquo;s bank).</li><li>The issuing bank verifies the card details, checks for sufficient funds or credit, and approves or declines the transaction.</li><li>The response is sent back through the card network and payment processor to the merchant.</li></ul></li><li>Capture:<ul><li>If the transaction is approved, the merchant receives an authorization code.</li><li>The merchant completes the sale and captures the transaction, typically at the end of the day or in batches.</li><li>The merchant sends the captured transactions to their payment processor.</li></ul></li><li>Clearing and Settlement:<ul><li>The payment processor sends the captured transactions to the card network for clearing.</li><li>The card network facilitates the exchange of funds and transaction information between the issuing bank and the acquiring bank (the merchant&rsquo;s bank).</li><li>The issuing bank deducts the transaction amount from the customer&rsquo;s account.</li><li>The acquiring bank receives the funds and credits the merchant&rsquo;s account, minus any applicable fees.</li></ul></li><li>Funding:<ul><li>The merchant receives the funds in their account, typically within 1-3 business days after the settlement.</li></ul></li></ol></details><p>During this process, multiple security measures are also implemented to safeguard sensitive card information and prevent unauthorized or illegal transactions. These measures include encryption, compliance checks, and fraud detection, etc.</p><p><em><strong>It goes without saying that each participant involved in the process takes a small cut of the transaction.</strong></em> These fees can vary significantly depending on factors such as the type of card, the industry of the merchant, the transaction volume, and whether the transaction is conducted in person or online, etc. However, when combined, these fees can be surprisingly high. The general process and breakdown is illustrated in the diagram below.</p><p><span style=color:#0e97cb><em>Typical Workflow Of Card Payments</em></span></p><div align=center><img src=/The_Last_Big_Thing/pic3.png></div><p>As a consumer, you likely never notice the many fees involved because payment providers charge merchants rather than customers directly. Over time, these providers have built a powerful network effect, resulting in most customers (particularly in America and Europe) using credit or debit cards as their main form of payment. Despite the high costs, merchants has little choice but to participate in these networks to offer their customers a seamless and convenient payment experience.</p><h2 id=22-from-card-payment-to-open-banking>2.2 From card payment to open banking<a hidden class=anchor aria-hidden=true href=#22-from-card-payment-to-open-banking>#</a></h2><h3 id=221-digital-payments-came-in>2.2.1 Digital payments came in<a hidden class=anchor aria-hidden=true href=#221-digital-payments-came-in>#</a></h3><p>Things have changed since the late 1990s when online payment platforms started to emerge with the widespread use of the internet and the growth of e-commerce. These platforms allow users to make payments quickly and easily from anywhere with an internet connection, eliminating the need for cash or checks. The proliferation of smartphones in the 2000s has further accelerated the adoption of these platforms, as more customers have grown accustomed to the convenience of seamless digital payment experiences.</p><p>PayPal was launched in 1998, which soon became the dominant player in the early 2000s, and the introduction of Alipay in China in 2004, which has since become the world&rsquo;s largest mobile and online payment platform. In 2010, Stripe arrived, simplifying payment processing for businesses worldwide. The mobile era ushered in new players, with Apple Pay in 2014 and Google Pay in 2015 turning smartphones into digital wallets, changing how millions pay both online and in stores.</p><details><summary><i>👈Click to see details on how digital payment works</i></summary><ol><li>Checkout initiation: When a user is ready to make a purchase, they select their preferred payment method (online or mobile) and initiate the checkout process. If the user is not already logged in, they may be prompted to sign in or create an account.</li><li>Payment method selection: The user chooses their preferred payment method from the options they have previously set up, such as a credit card, debit card, or mobile wallet.</li><li>Authentication: The user authenticates the transaction using security measures like passwords, PINs, or biometric data (e.g., fingerprint or facial recognition for mobile payments).</li><li>Payment processing: The payment service provider securely processes the transaction, either verifying that the user has sufficient funds in their account, or communicating with the user&rsquo;s bank or card issuer to verify and authorize the payment. Fraud detection measures are applied during this step.</li><li>Confirmation and receipts: Once the payment is processed, both the user and the merchant receive confirmation of the transaction. Digital receipts may be sent via email or stored within the payment platform&rsquo;s interface.</li></ol></details><p>Digital payments act as a form of disintermediation relative to traditional card payments. <em><strong>Money from both users and merchants slowly builds up in the e-wallet, creating a fund pool.</strong></em> They rarely interact directly with the traditional payment systems anymore. Instead, transactions are simply internal bookkeeping entries, transferring amounts from one balance to another. This bypasses some of the previous intermediaries, and transactions are now essentially processed in &ldquo;batches&rdquo;. Moreover, these platforms offer financial products and yield opportunities to their customers, leveraging these funds while taking a commission.</p><p><span style=color:#0e97cb><em>Typical Workflow Of Digital Payments</em></span></p><div align=center><img src=/The_Last_Big_Thing/pic4.png></div><p>More importantly, the move toward digital payments, as the name suggests, is a digitalization process. <em><strong>Many of its benefits are (again) made possible by emerging technologies:</strong></em></p><ol><li>Prevailing of mobile devices and internet -> Convenience and Accessibility
The ubiquity of smartphones, user-friendly apps, and expansive internet and mobile networks make digital payments convenient and accessible, driving financial inclusion.</li><li>Adoption of tokenization and biometric authentication -> Enhanced Security
Implementing tokenization and biometric authentication significantly improves digital payment security compared to traditional card payments.</li><li>Utilization of cloud computing and digital infrastructure -> Reduced Costs
Leveraging cloud computing and digital infrastructure streamlines transaction processing, minimizing the need for physical infrastructure and reducing fraud-related costs.</li><li>Advancement in interoperability and integration -> Seamless User Experience
APIs, SDKs, and web services, allow digital payment platforms to seamlessly integrate with various digital services, enhancing user experience and encouraging widespread adoption.</li><li>Harnessing big data analytics and AI -> Expanded Business Opportunities
Payment companies employ big data analytics and AI to gain valuable customer insights, develop targeted strategies, and expand their market presence.</li></ol><h3 id=222-cutting-edge-technology-spreads-more-quickly-in-less-developed-areas>2.2.2 Cutting-edge technology spreads more quickly in less developed areas<a hidden class=anchor aria-hidden=true href=#222-cutting-edge-technology-spreads-more-quickly-in-less-developed-areas>#</a></h3><p><em><strong>Interestingly, most advanced payment technologies tend to spread more quickly in relatively less developed countries.</strong></em></p><p><span style=color:#0e97cb><em>POS Payment Methods By Volume</em></span></p><div align=center><img src=/The_Last_Big_Thing/pic5.jpeg></div><p><em>Data Source: <a href=https://worldpay.globalpaymentsreport.com/en>Global Payments Report 2024, Worldpay</a></em></p><p>Worldpay&rsquo;s report highlights two key trends:</p><ol><li>More developed regions generally have higher rates of cashless transactions due to better access to advanced technologies and stronger economic foundations, enabling quick adoption of new paradigms for improved convenience and efficiency.</li><li>Less developed regions are increasingly adopting digital payments. This contrasts with North America and Europe, where payment markets are mature and customers are used to card payments. In these established markets, the convenience of digital payments barely outweighs the costs of switching. Plus, established companies use various tactics to keep their market share, showing how resistant large-scale payment systems can be to change.</li></ol><p>This raises an interesting question about crypto payment adoption: Where would it be most effective? In developed countries, and places like China and India, widespread internet access and sophisticated financial systems are already in place. Here, cryptocurrencies offer benefits related to financial independence and privacy, as well as investment opportunities, but these are generally seen as nice-to-have features rather than essentials. On the flip side, in many other parts of Asia, Latin America, and Africa, where inflation is high or large segments of the population lack access to banks and payment platforms, crypto could significantly enhance the convenience and efficiency of financial transactions.</p><p><span style=color:#0e97cb><em>Daily crypto purchasing with ARS (Argentine Peso) vs. ARS value</em></span></p><div align=center><img src=/The_Last_Big_Thing/pic6.png></div><p><em>Source: <a href=https://www.chainalysis.com/blog/2023-global-crypto-adoption-index/>The 2023 Global Crypto Adoption Index, Chainalysis</a></em></p><p>Surprisingly, crypto, particularly stablecoins, is already gaining traction in various regions. In Argentina and Turkey, people use cryptocurrencies as a hedge against inflation, with about half of Turkey&rsquo;s youth owning some form of crypto. In the Philippines and Vietnam, cryptocurrencies facilitate remittances, helping workers abroad send money home efficiently. The Philippine central bank even introduced a stablecoin linked to the peso to promote financial inclusion. Across African cities, from Lagos to Nairobi, small and medium-sized businesses are increasingly accepting cryptocurrencies, reducing cross-border transaction fees from as much as 15% to between 1% and 3%.</p><p><span style=color:#0e97cb><em>8 Of The Top 10 Countries Leading In Crypto Adoption Are From Less-developed Regions</em></span></p><div align=center><img src=/The_Last_Big_Thing/pic7.png></div><p><em>Source: <a href=https://www.chainalysis.com/blog/2023-global-crypto-adoption-index/>The 2023 Global Crypto Adoption Index, Chainalysis</a></em></p><h1 id=3-entering-crypto-payments>3. Entering Crypto Payments<a hidden class=anchor aria-hidden=true href=#3-entering-crypto-payments>#</a></h1><h2 id=31-edges-and-reasons>3.1 Edges And Reasons<a hidden class=anchor aria-hidden=true href=#31-edges-and-reasons>#</a></h2><p>So why are crypto and blockchain beneficial?</p><h3 id=311-democratized-access>3.1.1 Democratized Access<a hidden class=anchor aria-hidden=true href=#311-democratized-access>#</a></h3><blockquote><p><span style=color:#0e97cb>1️⃣</span> Public blockchains <span style=color:#d73504><em><strong>democratize access to digitalized assets and ownership</strong></em></span> through their permissionless and decentralized networks. Node operators benefit from diverse source of revenues, enabling them to serve a broad audience that traditional banking and payment systems fail to reach.</p></blockquote><p>Traditional digital payment systems have already driven the marginal cost of serving an additional customer to nearly zero. In contrast, public blockchains usually have extra overhead due to communication costs and redundant work done by multiple nodes. However, node operators largely benefit from token issuance and other diverse revenue sources instead of relying solely on transaction fees.</p><p>Taking Ethereum node revenue as an example:</p><p><em>Currently:</em></p><ul><li>Consensus Layer Reward<ul><li>Token issuance - 82.5%</li></ul></li><li>Execution Layer Reward<ul><li>Priority gas fees (processing fees) - 11.7%</li><li>Baseline MEV - 5.9%</li></ul></li></ul><p><span style=color:#0e97cb><em>Ethereum Node Revenue Breakdown</em></span></p><div align=center><img src=/The_Last_Big_Thing/pic8.jpeg></div><p><em>Source: <a href="https://explorer.rated.network/network?network=mainnet&amp;timeWindow=30d&amp;rewardsMetric=average&amp;geoDistType=all&amp;hostDistType=all&amp;soloProDist=stake">Rated Network</a></em></p><p>Over the past 30 days, token issuance alone has accounted for 82.5% of a node&rsquo;s revenue, while priority gas fees - similar to payment processing fees in traditional systems - only contribute 11.7%. Although a 3.42% return rate may seem modest, it&rsquo;s denominated in ETH and the risks are fairly low. The scale of funds involved is significant, with around 33 million ETH staked, equating to over $100 billion - about 3.7‰ of the US GDP in 2023 or equivalent to the total US treasury bonds outstanding - all earning a 3%+ yield denominated in ETH annually. Looking ahead, revenue sources are expected to diversify further, with non-issuance rewards comprising a larger share.</p><p>These enriched revenue streams and high-value transactions make operating nodes a lucrative business, especially when done professionally. While some argue that L2s may not benefit from PoS staking, launching their own tokens, internalizing gas fees, and potentially earning MEV income could easily offset the disadvantages.</p><p>We further delve into the concentration of revenue at the transaction level. The data reveals that the top four transaction types contribute over 60% of the total MEV, yet they occupy only about 22% of the block space, measured by gas spent. These transaction types - Telegram Bot Flow, Sandwich MEV, Bot Swap Flow, and Non-Atomic Arbitrage MEV (essentially CEX-DEX arbitrage) - are primarily associated with trading rather than transfers or other activities. These sophisticated trading operations contribute significant economic rewards to node operators who maintain and secure the network infrastructure. In tandem with technical composability, this has produced a decentralized network serving a much wider audience across borders than ever before.</p><p><span style=color:#0e97cb><em>Order Flow Breakdown</em></span></p><div align=center><img src=/The_Last_Big_Thing/pic9.png></div><p><em>Source: <a href=https://x.com/boez95/status/1815520545774944466>‘Who Wins Ethereum Block Building Auctions and Why?’</a> by Burak Öz, Danning Sui, Thomas Thiery, Florian Matthes</em></p><h3 id=312-neutral-and-transparent-environment>3.1.2 Neutral And Transparent Environment<a hidden class=anchor aria-hidden=true href=#312-neutral-and-transparent-environment>#</a></h3><blockquote><p><span style=color:#0e97cb>2️⃣</span> Public blockchains excel at <span style=color:#d73504><em><strong>eliminating the trust assumptions, and thus the frictions of cross-party collaborations.</strong></em></span> Essentially, they provide a neutral and transparent environment ensured by trustless data processing and computation.</p></blockquote><p>If you have a deposit account with a bank in the US and want to send money to your family in Southeast Asia using a local bank account. You have a few options, but none are ideal. Traditional bank transfers typically take 3-5 days and come with fees ranging from 1-5%. Money transfer services can complete the transfer much faster - often within minutes or hours - but at a higher cost, typically between 5-10%. Even most online services, which are more convenient, usually only manage to transfer funds within 1-2 days, with fees ranging from 0.5-2%. Additionally, FX markups can add another 0.5-5% depending on the provider and other factors.</p><p>The primary reason for these lengthy and costly processes is that different banks and countries operate on separate &ldquo;ledgers&rdquo;. Each bank maintains its own booking system, and even global banks usually keep separate ledgers for different regions or countries. Currently, SWIFT serves as the primary messaging network that banks use to route global remittances. When you initiate a transfer, your bank debits your account and sends a message through SWIFT to the receiving bank. The receiving bank then processes this message and credits the recipient&rsquo;s account. If the two banks don&rsquo;t have a direct relationship, they must rely on one or more intermediary banks to route the messages and funds. These intermediary banks may be in different time zones, have varying levels of digital infrastructure, and follow their own procedures and policies. Some banks prefer to process international transfers in batches rather than in real time. All these factors contribute to significant delays and increased costs.</p><p>A similar situation unfolds daily across nearly every industry. Whether it&rsquo;s individuals, companies, organizations, regions, or entire countries, each party operates with its own interests in mind - collaborating when beneficial, but also competing with one another. Economic theories often suggest that this dynamic fosters optimal efficiency and sustains a vibrant society. However, it also undeniably gives rise to countless instances of the prisoner&rsquo;s dilemma, tragedy of the commons, and walled gardens. These dynamics introduce significant frictions in cross-party collaborations, often making such interactions complex, costly, and, in some cases, prohibitively difficult.</p><p>Blockchain offers a transformative approach by treating all participants equally and ensuring that every node maintains the exact same ledger, i.e., the canonical chain. Through a rigorous consensus mechanism and a cryptographically secured account system, blockchain guarantees that all applications and accounts operate strictly according to open-source coded rules. This framework allows a user to manage a single account from any location and transfer funds to anyone, anywhere, within seconds.</p><p>A bank &ldquo;on chain&rdquo; can directly communicate with other banks because they all operate on the same transparent ledger. This ledger is not only universally accessible but also verifiable by any participant, eliminating the need for trust and reducing waiting times. With blockchain, a farmer in rural China can make secure, trustless transactions with a financial service provider in a skyscraper on Wall Street. This is the power of blockchain: it removes barriers, enhances transparency, and democratizes access to financial and other services on a global scale.</p><h2 id=32-status-check>3.2 Status Check<a hidden class=anchor aria-hidden=true href=#32-status-check>#</a></h2><p>Despite its promising potential, crypto payments are still in the early stages of development and face significant challenges. These challenges include the rigidity of large-scale payment systems, resistance from established user habits, and the entrenched interests of existing financial giants. While Satoshi envisioned Bitcoin as a widely used form of digital cash, most goods and services in our daily lives are still priced in fiat currency. Therefore, the focus here is primarily on stablecoin payments.</p><h3 id=321-only-adding-extra-steps-on-top>3.2.1 Only Adding Extra Steps On Top<a hidden class=anchor aria-hidden=true href=#321-only-adding-extra-steps-on-top>#</a></h3><p><em><strong>Paradoxically, many current crypto payment solutions introduce additional layers on top of traditional payment methods.</strong></em> Take crypto cards, the most common product in this space, as an example.</p><p><span style=color:#0e97cb><em><strong>Typical Workflow Of Current ‘Crypto Payment’</strong></em></span></p><div align=center><img src=/The_Last_Big_Thing/pic10.png></div><p>Although it&rsquo;s often suggested that crypto payments might first gain traction in less developed areas with limited access to traditional banking and cards, I see it as more practical - and symbolically significant - to start with cards, given the current stage of the industry. The key strategy here is to leverage existing Visa and MasterCard networks, which together cover over 150 million merchants in more than 200 countries and territories. Without this approach, we would face the daunting task of convincing individual merchants to adopt a new payment method or persuading existing payment platforms to integrate with crypto systems - neither of which seems practical at this stage.</p><p>The early adopters in this space are typically card issuers or entities partnering with card issuers to borrow their issuing capabilities (via BIN sponsorship). <em><strong>When issuers promote the ability to spend crypto with their cards, the process typically involves converting crypto to fiat in advance.</strong></em> This is often done either through an off-ramp provider or managed by the issuer on the user&rsquo;s behalf. Once this process is complete, you can use the card for payments, which are effectively conducted in fiat currency and have little to do with crypto.</p><p>In this context, credit cards are fully backed by assets and are referred to as &ldquo;secured credit cards.&rdquo; This blurs the line between credit and debit cards, making the distinction between them minimal. While credit cards, debit cards, prepaid cards, and other payment forms do differ in terms of spending limits, use cases, and fee structures - and these differences can vary by country and region - the focus here is on card payments in general, without getting into the specific nuances of each type.</p><p>This approach does accommodate native crypto users to some extent, particularly those who hold a significant portion of their assets in crypto but still need to use fiat for everyday expenses. However, it is far from ideal and has several significant flaws:</p><ol><li><strong>Custody and Centralization Risks</strong>: During the period between funding the card and making a payment, users&rsquo; assets are effectively under custody, either with the issuers or specialized custody providers. This introduces potential centralization risks and complicates account management. Users must actively maintain their fiat account balances and are exposed to the risk of something going wrong on the custody side. Additionally, there&rsquo;s an opportunity cost, as users miss out on the potential yield that could have been earned on-chain through staking or other Defi protocols. While some issuers are beginning to offer yields to users, this typically involves lending funds to a portfolio manager, which introduces additional risks and costs.</li><li><strong>Increased Complexity and Costs</strong>: Contrary to the original promise of simplifying transactions and reducing intermediaries, this approach actually adds more steps and middlemen to the payment process. Currently, service providers typically charge 1%-3% just for topping up cards, and this cost is directly borne by the cardholders.</li></ol><h3 id=322-what-prevents-non-custodial-payments>3.2.2 What Prevents Non-custodial Payments<a hidden class=anchor aria-hidden=true href=#322-what-prevents-non-custodial-payments>#</a></h3><p>Given these issues, the question arises: Why can&rsquo;t users simply sign the payment transaction in real time? Why does off-ramping in advance seem necessary so far?</p><p><em>Provider Side:</em></p><ol><li><strong>Latency:</strong> When using traditional payment rails, card issuers are required to confirm a payment within approximately 5 seconds to ensure a smooth user experience and mitigate potential security risks. On L1s like Ethereum, this time frame is insufficient even to confirm the transaction&rsquo;s inclusion in a block, let alone achieving finality.</li><li><strong>Double Spending:</strong> While real-time authorization is technically feasible on L2s or highly performant L1s, several risks remain. A transaction could be reverted due to various issues such as chain re-orgs or network outages. Transactions that are pre-confirmed by rollup sequencers might be inadvertently or deliberately omitted. Moreover, sophisticated attackers could potentially overwrite their own transactions by bidding higher gas fees, allowing them to move assets to another address before the original transaction is finalized.</li></ol><p>The most significant risk faced by payment providers or card issuers in a non-custodial payment system is the possibility of not receiving the tokens as expected, in which case the provider would need to cover the shortfall with their own funds.</p><p><span style=color:#0e97cb><em>Attackers Grief Providers Through Double Spending</em></span></p><div align=center><img src=/The_Last_Big_Thing/pic11.png></div><p><em>User Side:</em></p><ol><li><strong>Gas Fees:</strong> One of the significant challenges for users in a crypto payment system is gas fees. On L1s, the gas fees can be prohibitively expensive, and even on L2s or cheap L1s, where gas fees are considerably lower, the costs can still be unacceptable for high-frequency, low-value transactions like daily payments.</li><li><strong>Signing and Managing:</strong> Up to this point, signing transactions with a card swipe has not been supported. Instead, users have had to manually sign each transaction using their phones or hardware wallets, which is far from ideal. Additionally, the process of signing and key management on mobile devices has been neither smooth nor secure. Furthermore, fine-grained access control is often expected, particularly by enterprise clients.</li></ol><p>Is it possible to offer solutions that address all these issues? With the introduction of several new primitives, the answer is now yes.</p><h2 id=32-trends>3.2 Trends<a hidden class=anchor aria-hidden=true href=#32-trends>#</a></h2><h3 id=321-the-rise-of-non-custodial-solutions>3.2.1 The Rise of Non-custodial Solutions<a hidden class=anchor aria-hidden=true href=#321-the-rise-of-non-custodial-solutions>#</a></h3><p>In the past two years, numerous innovative <em><strong>account designs</strong></em> have emerged, gradually dismantling previous barriers. Soon, users will no longer need to convert their crypto into fiat currency in advance.</p><p><span style=color:#12b886><em>Resource Lock - Instruments to prevent double spending</em></span><br><span style=color:#0e97cb><em>Implementations: MPC, TEE, Smart Contract, etc.</em></span><br><span style=color:#d73504><em>Issues solved: Double Spending, Latency</em></span></p><p>A resource lock is an instrument designed to help users make credible commitments regarding their account activities. It allows users to ensure that their account will or will not engage in specific behaviors, potentially based on certain conditions. One of the most common applications is preventing double spending, where users can credibly ensure they won&rsquo;t spend the same assets in their account more than once. This assurance allows service providers to proceed with the next steps even before the transaction is fully settled or finalized.</p><p><span style=color:#0e97cb><em>Resource Lock Can Improve UX By Large</em></span></p><div align=center><img src=/The_Last_Big_Thing/pic12.png></div><p>I borrowed the term from Frontier&rsquo;s research article, but these implementations have been widely used in the industry long before One Balance was introduced.</p><p><em><strong>Case1 - StablesMoney</strong></em></p><p>For example, Stables Money, an Australian-based card issuer, keeps users&rsquo; funds on-chain until payments are made. Stables utilizes MPC wallets, where private keys are split into three shards managed separately by the users, Stables, and Fireblocks, one of the largest custody providers. When a payment is initiated, Stables facilitates co-signing, initiates the transaction, and confirms it with the card network instantly. Meanwhile, they update the user&rsquo;s balance in their own database even before the transaction is finalized on-chain. When the user initiates a subsequent transaction, Stables checks the user&rsquo;s balance against their internal records, rejecting any double spending attempts. Under this setup, the only way for users to double spend is by bypassing Stables and colluding with Fireblocks within a short window, which is highly unlikely. However, this approach is still centralized, and theoretically, Stables and Fireblocks could collude to steal users&rsquo; funds.</p><p><em><strong>Case2 - Gnosis Pay</strong></em></p><p>Gnosis Pay takes a different approach, prioritizing decentralization over efficiency. In Gnosis Pay&rsquo;s system, transactions are categorized into card transactions and non-card transactions, with the latter typically initiated directly through wallets by users. Card transactions are confirmed instantly, while non-card ones are subject to a delay - a three-minute waiting period, during which time any previously initiated card transaction is usually settled and notified to the providers already. This design choice also helps mitigate the risk of a malicious double spending effectively.</p><p>Gnosis Pay implemented this method by adding a &ldquo;<a href="https://github.com/gnosisguild/zodiac-modifier-delay?tab=readme-ov-file">delay module</a>&rdquo; developed by Zodiac on top of a standard SAFE account. This solution is subtle and elegant but also very specific, which results in limited efficiency and flexibility. For example, if a user needs to quickly reallocate funds to prevent a liquidation, a three-minute waiting period could be fatal. It’s also worth mentioning that this type of transaction processing doesn’t support all card transactions, such as complex reversals or delayed refunds.</p><p>A resource lock can also be programmed to operate under specific conditions. For instance, in the cross-chain NFT purchasing scenario mentioned by Frontier, the locked funds could either be claimed by any solver who presents a valid fulfillment proof or be returned to the user after a set expiration period. Nowadays the cross-chain transaction experience has improved significantly between L2s and fast chains, but with a resource lock, waiting times can be minimized, even when bridging from the mainnet.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=n>resource_lock</span>: <span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>lock</span>: <span class=mi>1500</span><span class=w> </span><span class=no>USDC</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>fulfill</span>: <span class=nc>DeGods</span><span class=w> </span>#<span class=mi>12345</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>expiry</span>: <span class=nc>Solana</span><span class=w> </span><span class=n>block</span><span class=w> </span><span class=mi>245547084</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p><em>Source: <a href=https://ethresear.ch/t/introducing-onebalance/19557>Frontier Tech</a></em></p><p>This example demonstrates that a resource lock has versatile applications and should not limited to payments or cross-chain transactions alone.</p><p>Another implementation method that is certainly worth exploring involves leveraging TEEs. Within TEE, a resource lock would be fully programmable and highly efficient. By incorporating a decentralized network and robust attestation mechanisms, many of the concerns related to centralization and collusion could be alleviated. If implemented correctly, this approach could also achieve a high degree of security.</p><p>Resource locks may introduce additional trust assumptions, but when properly implemented, they have the potential to unlock a myriad of use cases that are currently infeasible and significantly enhance the user experience. The greatest advantage of this concept lies in its ability to allow the next action to proceed as if the previous one has already been completed, thereby eliminating many of the frictions that typically hinder user experience. Essentially, &ldquo;it decouples fulfillment from settlement&rdquo;, said Frontier.</p><p>A card issuer could confirm a transaction as though it has already been settled. A solver could advance funds to the user on the destination chain as if the assets were already locked on the source chain.</p><p>Imagine a future where not only users but also solvers, market makers, and other providers adopt resource locks with a uniform, interoperable standard. In such a scenario, the entire process - from initiating a transaction to routing, fulfilling, and confirming it - could occur in an instant. This would finally bring instant, low-cost, and enriched crypto usage experience on par with that of Web2.</p><p><span style=color:#12b886><em>Fast confirmation: Near-Instant Transaction Confirmations</em></span><br><span style=color:#0e97cb><em>Implementations: High-performance chains, Pre-confirmation, etc.</em></span><br><span style=color:#d73504><em>Issues solved: Double spending, Latency</em></span></p><p>Another approach to addressing finality and latency is to enable fast confirmations. One viable method is to develop high-performance, stable chains where even large volumes of transactions can be settled in real-time. When a transaction is settled within milliseconds, providers and merchants receive a definitive outcome instantly, making it extremely difficult for even sophisticated attackers to double spend or exploit the system. Teams like MegaETH and others are actively working on this front.</p><p>Alternatively, on mainnet or based rollups, pre-confirmations could achieve similar results if implemented effectively. Pre-confirmation allows L1 proposers to opt into a new supply branch, allocating part of the block space and committing to include certain transactions in advance, before the entire block is constructed and broadcast across the network. Projects like Commit Boost, Luban, and Chainbound are among those undertaking the comprehensive design and engineering required to make this a reality.</p><p><span style=color:#12b886><em>Smart Contract Accounts - Customized logic and enriched function defined by smart contracts</em></span><br><span style=color:#0e97cb><em>Implementations: Zerodev, Particle, etc.</em></span><br><span style=color:#d73504><em>Issues solved: Signing & Managing</em></span></p><p>The signing experience is generally straightforward when using crypto-native apps for payments, as a wallet is embedded, and transactions are signed when users select &ldquo;pay now&rdquo; or &ldquo;transfer.&rdquo; However, this becomes a challenge for non-custodial card designers, who must ask users to swipe their cards and approve transactions separately. Tangem is developing a product that combines a hardware wallet and a payment card, but this approach requires customized manufacturing, which increases costs.</p><p>Additionally, as the signature curve used by most of the mainstream blockchains today, Secp256k1, is not integrated or supported by most of the mobile manufactures, the private keys for EOAs are usually maintained and utilized at a software level, instead of leveraging dedicated secured enclaves used for modern key managements on mobile devices. That imposes extra risks for mobile payment app users.</p><p>Furthermore, the signature curve used by most mainstream blockchains today, Secp256k1, is not integrated or supported by most mobile manufacturers. As a result, private keys for EOAs are typically managed at the software level rather than leveraging the secure enclaves used in modern mobile key management, which introduces additional risks for payment app users.</p><p>There is also a growing demand for fine-grained payment access controls. For example, enterprises may want to grant access to employees only during business trips, with specific spending limits. Parents might want to allow their children to use a card for specific purposes under certain limits.</p><p>To address these needs, smart contract accounts are being actively developed by various startups. These accounts enable users to delegate balance deductions to others on their behalf, with the ability to specify spending limits, time constraints, and other granular details.</p><p><span style=color:#12b886><em>Pay Master - Enabling gas payment for others or in alternative tokens</em></span><br><span style=color:#0e97cb><em>Implementations: Biconomy Paymaster, Pimlico Paymaster, etc.</em></span><br><span style=color:#d73504><em>Issues solved: Gas Fees</em></span></p><p>Abstracting gas fees away from the user experience is crucial for making blockchain technology more accessible and user-friendly.</p><p>Summarizing above into one chart:<br><span style=color:#0e97cb><em>Hurdles For Non-custodial Crypto Payment And Primitives That Help</em></span></p><div align=center><img src=/The_Last_Big_Thing/pic13.jpeg></div><h3 id=322-integration-with-defi-protocols><strong>3.2.2 Integration with Defi Protocols</strong><a hidden class=anchor aria-hidden=true href=#322-integration-with-defi-protocols>#</a></h3><p>Users are increasingly seeking payment products that seamlessly integrate with Defi protocols, offering yield opportunities and sophisticated asset management in a trustless manner.</p><p>The traditional payment system, despite its complexity, essentially only revolves around two basic instructions: debit and credit. As Holyheld describes in their whitepaper:</p><p>&ldquo;…In-between consumer and product there are numerous intermediaries each one of them executing, transmitting, or relaying a simple instruction. At each step, there is a reconciliation of debit and credit instructions. It is not possible to program or enrich such instructions…&rdquo;</p><p>To access additional asset management tools and opportunities, users are forced to turn to separate institutions and third parties. This reliance on siloed, independently maintained ledgers introduces significant costs and frictions.</p><p>Defi was created to address these issues. While still in its early stages, Defi has already introduced a variety of on-chain yield opportunities, including:</p><ul><li>Staking and restaking - Earning yield by helping to operate a blockchain or protocol.</li><li>LP fees - Generating revenue by providing liquidity where depth or immediacy matters</li><li>RWA - yield from redirecting on-chain funds to off-chain assets</li><li>CeDefi - revenue from redirecting on-chain funds to off-chain strategies</li></ul><p>Moreover, we&rsquo;re witnessing the development of numerous automation tools, combinations, derivatives, and strategies built on top of these protocols. The logical next step is to close the last mile by integrating payment applications with Defi protocols. This would allow users to store, manage, and spend their assets seamlessly and trustlessly within one single account.</p><p><em><strong>Case1 - Etherfi</strong></em></p><p>Partnering with Scroll, Etherfi recently launched <a href=https://x.com/ether_fi/status/1833132921143906398>a &ldquo;real&rdquo; credit card</a>, which aligns perfectly with this mission. Currently, Etherfi is best known as an LRT protocol built on top of EigenLayer. However, with the introduction of Cash, users will gain the ability to borrow and spend stablecoins against their staking positions using Visa credit cards issued through the platform. The outstanding balances on these cards can be automatically paid off with the interest generated from their staking. Etherfi also offers Liquid, which provides vaults with automated Defi strategies. Users simply deposit their tokens, and behind the scenes, the vault allocates funds across various Defi positions.</p><p><em><strong>Case2 - RoboSaver</strong></em>
In contrast, Onchainification Labs advocates for a non-custodial approach. They have released an alpha version of <a href=https://github.com/onchainification/robosaver>RoboSaver</a>, a smart contract module designed for installation on the Safe smart account that underpins every Gnosis Pay card. This module allows users to deposit the idle balance into Defi protocols like Balancer or Aura, where it earns yield and collects swapping fees. When the card balance falls below a certain threshold, RoboSaver automatically withdraws assets from the pool to top up the card. The contracts have already been deployed, and a withdrawal was successfully <a href=https://gnosisscan.io/tx/0x155499dd64a0340129144ce0e47e2549817ad72e95d5d2836bbbf7acbb0750dc>triggered</a> during an experiment where they purchased a coffee.</p><p>Here are two products or features that I think hold the most immense potential:</p><ol><li><p><em><strong>Allowing users to borrow and pay with stablecoins against their staking/restaking positions</strong> (just as Etherfi Cash is doing):</em></p><p>Staking is a cornerstone in the crypto world, often viewed as the equivalent of a risk-free rate. It offers simplicity and predictable yields, attracting a significant number of participants and substantial assets. Many stakers, especially large investors (whales), might appreciate having a card for everyday use.</p><p>It might sound like a credit card, but can be uniquely structured by incorporating a liquidity pool model between users and issuers. This way, issuers wouldn&rsquo;t need to use their own funds for transactions, allowing assets to be settled promptly.</p><p>Alternatively, we could leverage existing lending protocols like AAVE or Compound. The Holyheld team has conducted internal tests for credit lines using wstETH (Lido) and AAVE&rsquo;s V3 delegation module. While the system functions as intended, there&rsquo;s a significant limitation: AAVE&rsquo;s credit delegation only supports an &ldquo;all or nothing&rdquo; approach. This means it&rsquo;s impossible to delegate just a portion of the position or a specific amount. Compound faces the same issue.</p></li><li><p><em><strong>Allowing users to hold and pay with (risk-free) yield-bearing assets:</strong></em></p><p>It&rsquo;s ironic that most crypto users - from retail investors to most professional institutions - continue to lend funds to Tether and Circle without receiving any yield in return. In a highly digitalized world, users should be experiencing more transparency and fairness, not continued exploitation by centralized entities. RWAs, particularly yield-bearing stablecoins, are poised to iterate on the current ones. The importance of a risk-free, yield-bearing stablecoin cannot be overstated, as bonds and treasuries have long been the go-to investment vehicles in many parts of the world. These are highly standardized, easy to understand, and backed by sovereign nations. Many people hold USDT or USDC as a digital alternative to the dollar, primarily because it offers better protection against inflation than the fiat currency of their own country. Naturally, these users would also want to earn a risk-free interest rate on their holdings. However, adoption remains low, and this can be attributed to two main factors:</p><ul><li><p><strong>On-chain challenges:</strong> The current standards for yield-bearing tokens are not easily integrated into existing systems, creating friction.</p><p>For a token to be considered a stablecoin, its value must remain stable, but the assets backing these RWA protocols, like treasuries and bonds, appreciate over time. To pass this value back to users while keeping the token price stable, many yield-bearing stablecoins, such as USDM by Mountain and STBT by Matrixport, use a rebase token model. This model adjusts all holders&rsquo; balances proportionally using a <code>rebaseFactor</code> to reflect the accrued value. Although it&rsquo;s a neat design, it has yet to gain widespread support from Defi protocols, wallets, and centralized exchanges, where the simpler ERC-20 standard still dominates. Additionally, these protocols typically trigger the rebase process once a day, which can create arbitrage opportunities for traders and lead to price fluctuations that many users find undesirable. One possible solution is to stream rewards on a block-by-block basis, which could help smooth out price fluctuations. However, this approach would incur significant gas costs, and the potential for arbitrage would still remain.</p></li><li><p><strong>Off-chain Challenges:</strong> Issuing these types of assets could potentially expose projects to significant legal risks, particularly from the SEC, as they may be deemed &ldquo;unregistered securities.&rdquo;</p><p>This is why many of these projects explicitly exclude U.S. residents or citizens from their services. These protocols often invest considerable time and resources in developing legal frameworks to ensure that users can retrieve their assets even if the protocol itself fails (bankruptcy remote). However, until new legislation is passed or any precedent-setting case is decided, the legal outlook for these projects remains uncertain.</p></li></ul><p>Another key factor in establishing a widely adopted stablecoin is building a comprehensive, globally distributed banking support network. While on-ramping is important, ensuring a smooth off-ramp process for merchants or institutions is even more critical. Tether achieves this through a network of distributors, while Circle leverages its compliance and strong relationships with various banks. New entrants into the market will need to determine their own strategies. For RWAs, gaining access to deep liquidity, such as that offered by firms like BlackRock, could be crucial.</p></li></ol><p>In the near future, payment systems will become seamlessly integrated into the entire Defi ecosystem. Individuals will have access to a wide range of investment vehicles, management tools, and strategies, all from a unified account.</p><p>Moreover, cryptocurrency payments will be increasingly integrated into traditional financial systems. Currently, issuing banks are the first to adopt cryptocurrency because they manage the initial stages of fund flow and are most downstream in the information flow. Once these issuers handle the conversion between crypto and fiat, other participants, such as card networks and acquiring banks, can operate without needing to be aware of the cryptocurrency involved.</p><p>However, in the long term, we can expect cryptocurrency to be integrated further downstream in the fund flow - or, conversely, further upstream in the information flow - due to its efficiency and cost-effectiveness, with fewer conversions required. We&rsquo;ve already seen Visa and MasterCard actively exploring the integration of crypto into their networks and traditional payment rails, signaling a definitive shift in the industry. Similarly, Stripe&rsquo;s <a href=https://x.com/jeff_weinstein/status/1844080628427620642>recent move</a> to enable stablecoin payments further underscores this trend.</p><p>As cryptocurrency adoption grows, more funds will remain on-chain for secure and convenient management, as well as to take advantage of better yield opportunities, with conversions to fiat occurring only when necessary.</p><h1 id=4-closing-thoughts>4. Closing Thoughts<a hidden class=anchor aria-hidden=true href=#4-closing-thoughts>#</a></h1><h2 id=41-how-should-crypto-payments-ideally-work>4.1 How should crypto payments ideally work?<a hidden class=anchor aria-hidden=true href=#41-how-should-crypto-payments-ideally-work>#</a></h2><p>While the exact future remains uncertain, we can envision an ideal scenario based on current knowledge and trends.</p><p>In the future, the process of making crypto payments should be as seamless and quick as today&rsquo;s digital payments. Customers would only need to engage in a brief interaction with the merchant, similar to how we currently use QR codes, NFC, or biometric authentication. This simple interaction would allow the merchant to identify the user&rsquo;s abstracted or smart account, powered by the primitives discussed in section 3.2.1.</p><p>A payment processor, serving as one of the few intermediaries in this streamlined system, would handle a range of security checks on behalf of the merchant and the user. These checks might include identity verification, balance confirmation, AML compliance, fraud detection, and access control, among others. Once these checks are successfully completed, the payment request would be routed to the user&rsquo;s smart account.</p><p>This smart account could be used to hold a variety of assets, such as those related to staking, liquidity provision, RWA, CeDefi products, or other yield-generating opportunities and their combinations. Importantly, these assets would remain non-custodial, fully controlled by the user. Pre-authorization and access control would be defined and granted through smart contracts, with gas fees often being covered by the app or service provider.</p><p>To ensure speed and security, the system could leverage resource locks, fast confirmations, or high-performance chains. This would enable payment processors or other service providers to confirm transactions almost instantly, minimizing the risk of malicious activity. The merchant would receive immediate notification of the transaction&rsquo;s completion status, while the actual settlement of funds could occur either instantly or at a later time. Ultimately, the corresponding assets would be transferred to the merchant&rsquo;s account, closing the transaction.</p><p><em>(Ideal) Crypto Payment Flowchart</em></p><div align=center><img src=/The_Last_Big_Thing/pic14.png></div><p>As you may have noticed, in addition to the payment processor, another third party that users and merchants will likely need to rely on is the account service provider or manager. This necessity arises because basic native accounts, such as EVM EOAs, are insufficient for delivering the smooth experience and complex management. Moreover, a purely open-source solution may struggle to keep pace with the rapid evolution of blockchain technology and the changing needs of users.
A key advantage of crypto payments, which helps minimize the number of intermediaries and thus reduces costs, is that <em><strong>blockchain unifies the flow of funds and information within a single ledger</strong></em>.</p><h2 id=42-unification-democratization-and-disintermediation>4.2 Unification, Democratization, and Disintermediation<a hidden class=anchor aria-hidden=true href=#42-unification-democratization-and-disintermediation>#</a></h2><p><em><strong>Payment Eras</strong></em></p><div align=center><img src=/The_Last_Big_Thing/pic15.png></div><p>To summarize the entire article:</p><p>Card payments marked the beginning of the digitalization of financial transactions, leveraging computers and the internet for bookkeeping and information transmission. As the payment industry grew and technology advanced, the process involved an increasing number of specialized intermediaries. Digital payments furthered this digitalization by utilizing emerging technologies as consumer internet usage became widespread. It also disintermediated the traditional process by abstracting away customers&rsquo; direct interactions with banks.</p><p>Blockchain and crypto payments take this disintermediation a step further, offering a system where users retain control of their assets while gaining access to a wide array of composable yield opportunities and asset management tools. This technology provides a decentralized and permissionless network, making digital assets and ownership accessible to nearly everyone on the planet. It fosters a transparent and neutral environment where all parties can collaborate without needing to establish trust beforehand.</p></div><footer class=post-footer><nav class=paginav><a class=next href=http://localhost:1313/writings/need-for-speed/><span class=title>Next »</span><br><span>Need for Speed: Zero Knowledge</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=http://localhost:1313/>Larry007's</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>